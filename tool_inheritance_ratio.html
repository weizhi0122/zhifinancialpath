<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>ç¹¼æ‰¿æ¯”ä¾‹è©¦ç®—å·¥å…·ï½œæ™º Financial Path</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="æ‡‰ç¹¼åˆ†/ç‰¹ç•™åˆ†è©¦ç®—ï¼šæ”¯æ´é…å¶ã€å­å¥³ã€çˆ¶æ¯ã€å…„å¼Ÿå§Šå¦¹ã€ç¥–çˆ¶æ¯ï¼ˆå°ç£æ³•å®šç¹¼æ‰¿ï¼‰" />

<style>
  .topbar{
  background:#ffffff;
  border-bottom:1px solid #e6e8ee;
  padding:10px 20px;
  position:sticky;
  top:0;
  z-index:100;
}

.topbar-inner{
  max-width:1050px;
  margin:auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.left-nav a{
  margin-right:18px;
  text-decoration:none;
  color:#0b3d91;
  font-size:14px;
  font-weight:600;
}

.left-nav a:hover{
  text-decoration:underline;
}

.brand{
  font-size:13px;
  color:#667085;
}

  :root{
    --bg:#f6f8fb; --card:#fff; --text:#222; --muted:#667085;
    --line:#e6e8ee; --primary:#0b3d91; --soft:#eef4ff;
    --warnbg:#fff4e5; --warn:#8a5300;
  }
  body{font-family:Arial,"Noto Sans TC",sans-serif;margin:0;background:var(--bg);color:var(--text)}
  .container{max-width:1050px;margin:auto;padding:26px 18px}
  h1{margin:0 0 12px;color:var(--primary);font-size:26px}
  .grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media (min-width:980px){ .grid{grid-template-columns:1.15fr 0.85fr} }
  .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .card h2{margin:0 0 10px;font-size:16px;color:#0f172a}
  label{display:block;margin-top:10px;font-size:14px;color:#0f172a}
  input,select,button{
    width:100%;padding:10px 10px;margin-top:6px;border:1px solid #d7dbe6;border-radius:10px;
    box-sizing:border-box;background:#fff;font-size:14px;
  }
  .row{display:flex;gap:10px}
  .row > *{flex:1}
  button{margin-top:14px;background:var(--primary);color:#fff;border:0;cursor:pointer;font-weight:700}
  button.secondary{background:#334155}
  .result{margin-top:14px;padding:14px;border-radius:12px;background:var(--soft);color:var(--primary);display:none}
  .warn{display:none;margin-top:10px;padding:10px 12px;border-radius:12px;background:var(--warnbg);color:var(--warn);border:1px solid #ffe2b5;font-size:13px;line-height:1.4}
  .small{font-size:12.5px;color:var(--muted);line-height:1.45;margin-top:10px}
  .pill{display:inline-block;font-size:12px;padding:4px 8px;border-radius:999px;background:#f1f5ff;color:var(--primary);border:1px solid #dbe7ff}
  .table{width:100%;border-collapse:collapse;margin-top:10px}
  .table th,.table td{padding:7px 0;border-bottom:1px dashed #dbe2f0;font-size:13.5px}
  .table th{text-align:left;color:#0f172a}
  .table td:last-child,.table th:last-child{text-align:right}
  .muted{color:var(--muted)}
</style>
</head>

<body>
<div class="topbar">
  <div class="topbar-inner">
    <div class="left-nav">
      <a href="./tools.html">â† å›å·¥å…·</a>
      <a href="./index.html">ğŸ  å›ä¸»é </a>
    </div>
    <div class="right-nav">
      <span class="brand">æ™º Financial Path</span>
    </div>
  </div>
</div>

<div class="container">
  <h1>æ‡‰ç¹¼åˆ† / ç‰¹ç•™åˆ†è©¦ç®— <span class="pill">æ”¯æ´å®Œæ•´æ³•å®šç¹¼æ‰¿çµ„åˆ</span></h1>

  <div class="grid">
    <!-- å·¦ï¼šè¼¸å…¥ -->
    <div class="card">
      <h2>1) å®¶åº­/ç¹¼æ‰¿äººè¨­å®š</h2>

      <label>å¿«é€Ÿé¸æ“‡ï¼ˆPresetsï¼‰</label>
      <select id="preset" onchange="applyPreset()">
        <option value="custom">è‡ªè¨‚ï¼ˆæˆ‘è‡ªå·±å¡«ï¼‰</option>
        <option value="spouse_only">é…å¶ï¼ˆåªæœ‰é…å¶ï¼‰</option>
        <option value="spouse_desc">é…å¶ + ç›´ç³»å‘è¦ªå±¬ï¼ˆå­å¥³/ä»£ä½å­«å­å¥³ï¼‰</option>
        <option value="spouse_parents">é…å¶ + çˆ¶æ¯</option>
        <option value="spouse_siblings">é…å¶ + å…„å¼Ÿå§Šå¦¹</option>
        <option value="spouse_grandparents">é…å¶ + ç¥–çˆ¶æ¯</option>
        <option value="desc_only">ç„¡é…å¶ + ç›´ç³»å‘è¦ªå±¬</option>
        <option value="parents_only">ç„¡é…å¶ + çˆ¶æ¯</option>
        <option value="siblings_only">ç„¡é…å¶ + å…„å¼Ÿå§Šå¦¹</option>
        <option value="grandparents_only">ç„¡é…å¶ + ç¥–çˆ¶æ¯</option>
      </select>

      <div class="warn" id="warnBox"></div>

      <label>æ˜¯å¦æœ‰é…å¶</label>
      <select id="hasSpouse" onchange="enforceOrder()">
        <option value="1">æœ‰</option>
        <option value="0">ç„¡</option>
      </select>

      <div class="row">
        <div>
          <label>ç›´ç³»å‘è¦ªå±¬äººæ•¸ï¼ˆå­å¥³/ä»£ä½ï¼‰</label>
          <input id="desc" type="number" min="0" step="1" value="2" oninput="enforceOrder()" />
        </div>
        <div>
          <label>çˆ¶æ¯äººæ•¸</label>
          <input id="parents" type="number" min="0" step="1" value="0" oninput="enforceOrder()" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>å…„å¼Ÿå§Šå¦¹äººæ•¸</label>
          <input id="siblings" type="number" min="0" step="1" value="0" oninput="enforceOrder()" />
        </div>
        <div>
          <label>ç¥–çˆ¶æ¯äººæ•¸</label>
          <input id="grandparents" type="number" min="0" step="1" value="0" oninput="enforceOrder()" />
        </div>
      </div>

      <div class="row">
        <button onclick="calc()">è¨ˆç®—æ¯”ä¾‹</button>
        <button class="secondary" onclick="resetDefaults()">é‡è¨­</button>
      </div>

      <p class="small">
        è¦å‰‡æé†’ï¼šé™¤é…å¶å¤–ï¼Œæ³•å®šç¹¼æ‰¿äººä¾åºç‚ºã€Œå‘è¦ªå±¬â†’çˆ¶æ¯â†’å…„å¼Ÿå§Šå¦¹â†’ç¥–çˆ¶æ¯ã€ï¼Œå‰é †ä½å­˜åœ¨æ™‚å¾Œé †ä½ä¸æœƒåŒæ™‚ç¹¼æ‰¿ã€‚
      </p>
    </div>

    <!-- å³ï¼šè¼¸å‡º -->
    <div class="card">
      <h2>çµæœ</h2>
      <div id="output" class="result"></div>
      <div class="small muted" style="margin-top:10px">
        ç‰¹ç•™åˆ†å€ç‡ï¼šé…å¶/å‘è¦ªå±¬/çˆ¶æ¯ = æ‡‰ç¹¼åˆ†Ã—1/2ï¼›å…„å¼Ÿå§Šå¦¹/ç¥–çˆ¶æ¯ = æ‡‰ç¹¼åˆ†Ã—1/3ã€‚
      </div>
    </div>
  </div>
</div>

<script>
function $(id){ return document.getElementById(id); }

function clampInt(v){
  if(!Number.isFinite(v)) return NaN;
  return Math.max(0, Math.floor(v));
}

function showWarn(msg){
  const w = $("warnBox");
  if(!msg){ w.style.display="none"; w.textContent=""; return; }
  w.style.display="block";
  w.textContent = msg;
}

function hideOutput(){
  $("output").style.display="none";
  $("output").innerHTML="";
}

function resetDefaults(){
  $("preset").value = "custom";
  $("hasSpouse").value = "1";
  $("desc").value = 2;
  $("parents").value = 0;
  $("siblings").value = 0;
  $("grandparents").value = 0;
  showWarn("");
  hideOutput();
}

/**
 * å¼·åˆ¶ç¹¼æ‰¿é †ä½ï¼ˆé™¤é…å¶å¤–åƒ…èƒ½å­˜åœ¨ä¸€å€‹é †ä½ï¼‰
 * æœ‰å‘è¦ªå±¬ -> æ¸…çˆ¶æ¯/å…„å¼Ÿå§Šå¦¹/ç¥–çˆ¶æ¯
 * æœ‰çˆ¶æ¯ -> æ¸…å…„å¼Ÿå§Šå¦¹/ç¥–çˆ¶æ¯
 * æœ‰å…„å¼Ÿå§Šå¦¹ -> æ¸…ç¥–çˆ¶æ¯
 */
function enforceOrder(){
  const desc = clampInt(Number($("desc").value));
  const parents = clampInt(Number($("parents").value));
  const siblings = clampInt(Number($("siblings").value));
  const gps = clampInt(Number($("grandparents").value));

  if([desc, parents, siblings, gps].some(v => !Number.isFinite(v))){
    showWarn("äººæ•¸æ¬„ä½è«‹è¼¸å…¥ 0 æˆ–æ­£æ•´æ•¸ã€‚");
    return;
  }

  let changed = false;
  showWarn("");

  if(desc > 0){
    if(parents>0){ $("parents").value=0; changed=true; }
    if(siblings>0){ $("siblings").value=0; changed=true; }
    if(gps>0){ $("grandparents").value=0; changed=true; }
    if(changed) showWarn("å·²åµæ¸¬åˆ°åŒæ™‚å¡«å…¥å¤šå€‹ç¹¼æ‰¿é †ä½ï¼›æœ‰å‘è¦ªå±¬æ™‚ï¼Œçˆ¶æ¯/å…„å¼Ÿå§Šå¦¹/ç¥–çˆ¶æ¯ä¸æœƒåŒæ™‚ç¹¼æ‰¿ï¼Œå·²è‡ªå‹•æ¸…é›¶å¾Œé †ä½ã€‚");
  }else if(parents > 0){
    if(siblings>0){ $("siblings").value=0; changed=true; }
    if(gps>0){ $("grandparents").value=0; changed=true; }
    if(changed) showWarn("å·²åµæ¸¬åˆ°åŒæ™‚å¡«å…¥å¤šå€‹ç¹¼æ‰¿é †ä½ï¼›æœ‰çˆ¶æ¯æ™‚ï¼Œå…„å¼Ÿå§Šå¦¹/ç¥–çˆ¶æ¯ä¸æœƒåŒæ™‚ç¹¼æ‰¿ï¼Œå·²è‡ªå‹•æ¸…é›¶å¾Œé †ä½ã€‚");
  }else if(siblings > 0){
    if(gps>0){ $("grandparents").value=0; changed=true; }
    if(changed) showWarn("å·²åµæ¸¬åˆ°åŒæ™‚å¡«å…¥å¤šå€‹ç¹¼æ‰¿é †ä½ï¼›æœ‰å…„å¼Ÿå§Šå¦¹æ™‚ï¼Œç¥–çˆ¶æ¯ä¸æœƒåŒæ™‚ç¹¼æ‰¿ï¼Œå·²è‡ªå‹•æ¸…é›¶å¾Œé †ä½ã€‚");
  }

  hideOutput();
}

function applyPreset(){
  const p = $("preset").value;

  // å…ˆæ¸…ç©º
  $("desc").value = 0;
  $("parents").value = 0;
  $("siblings").value = 0;
  $("grandparents").value = 0;

  switch(p){
    case "spouse_only":
      $("hasSpouse").value = "1";
      break;
    case "spouse_desc":
      $("hasSpouse").value = "1";
      $("desc").value = 2;
      break;
    case "spouse_parents":
      $("hasSpouse").value = "1";
      $("parents").value = 2;
      break;
    case "spouse_siblings":
      $("hasSpouse").value = "1";
      $("siblings").value = 2;
      break;
    case "spouse_grandparents":
      $("hasSpouse").value = "1";
      $("grandparents").value = 2;
      break;

    case "desc_only":
      $("hasSpouse").value = "0";
      $("desc").value = 2;
      break;
    case "parents_only":
      $("hasSpouse").value = "0";
      $("parents").value = 2;
      break;
    case "siblings_only":
      $("hasSpouse").value = "0";
      $("siblings").value = 2;
      break;
    case "grandparents_only":
      $("hasSpouse").value = "0";
      $("grandparents").value = 2;
      break;

    default:
      // custom ä¸å‹•
      break;
  }
  enforceOrder();
}

function pct(x){
  return (x*100).toFixed(2) + "%";
}

function frac(numer, denom){
  // ç°¡å–®åˆ†æ•¸é¡¯ç¤ºï¼ˆä¸åšç´„åˆ†ä¹Ÿè¡Œï¼Œä½†æˆ‘å€‘åšä¸€ä¸‹ç´„åˆ†æ›´å¥½çœ‹ï¼‰
  const g = gcd(numer, denom);
  return `${numer/g}/${denom/g}`;
}
function gcd(a,b){ a=Math.abs(a); b=Math.abs(b); while(b){ [a,b]=[b,a%b]; } return a||1; }

/**
 * ç‰¹ç•™åˆ†å€ç‡ï¼ˆæ°‘æ³•ç¬¬1223æ¢ï¼‰
 * - é…å¶ / ç›´ç³»å‘è¦ªå±¬ / çˆ¶æ¯ï¼šæ‡‰ç¹¼åˆ† * 1/2
 * - å…„å¼Ÿå§Šå¦¹ / ç¥–çˆ¶æ¯ï¼šæ‡‰ç¹¼åˆ† * 1/3
 */
function reserveMultiplier(role){
  if(role==="spouse" || role==="desc" || role==="parents") return 1/2;
  if(role==="siblings" || role==="grandparents") return 1/3;
  return 0;
}

function calc(){
  const hasSpouse = Number($("hasSpouse").value) === 1;
  const desc = clampInt(Number($("desc").value));
  const parents = clampInt(Number($("parents").value));
  const siblings = clampInt(Number($("siblings").value));
  const gps = clampInt(Number($("grandparents").value));

  if([desc, parents, siblings, gps].some(v => !Number.isFinite(v))){
    alert("äººæ•¸æ¬„ä½è«‹è¼¸å…¥ 0 æˆ–æ­£æ•´æ•¸");
    return;
  }

  enforceOrder(); // ç¢ºä¿ä¸çŸ›ç›¾

  // æ±ºå®šã€Œé™¤é…å¶å¤–ã€æ¡ç”¨å“ªä¸€é †ä½
  const order = (desc>0) ? "desc" : (parents>0) ? "parents" : (siblings>0) ? "siblings" : (gps>0) ? "grandparents" : "none";

  const rows = [];

  // æ‡‰ç¹¼åˆ†ï¼šä»¥æ•´é«”éºç”¢ = 1 ä¾†åˆ†é…
  if(hasSpouse){
    if(order === "desc"){
      // é…å¶èˆ‡å‘è¦ªå±¬å¹³å‡ï¼ˆæ¯äººåŒé¡ï¼‰
      const totalPeople = 1 + desc;
      const each = 1 / totalPeople;
      rows.push({ who:"é…å¶", count:1, entitledEach:each, entitledTotal:each, reserveEach: each*reserveMultiplier("spouse") });
      rows.push({ who:"æ¯ä½å‘è¦ªå±¬", count:desc, entitledEach:each, entitledTotal:each*desc, reserveEach: each*reserveMultiplier("desc") });
    }else if(order === "parents"){
      // é…å¶ 1/2ï¼Œçˆ¶æ¯åˆè¨ˆ 1/2 å¹³åˆ†
      const spouseShare = 1/2;
      const eachParent = (parents>0) ? (1/2)/parents : 0;
      rows.push({ who:"é…å¶", count:1, entitledEach:spouseShare, entitledTotal:spouseShare, reserveEach: spouseShare*reserveMultiplier("spouse") });
      rows.push({ who:"æ¯ä½çˆ¶æ¯", count:parents, entitledEach:eachParent, entitledTotal:eachParent*parents, reserveEach: eachParent*reserveMultiplier("parents") });
    }else if(order === "siblings"){
      // é…å¶ 1/2ï¼Œå…„å¼Ÿå§Šå¦¹åˆè¨ˆ 1/2 å¹³åˆ†
      const spouseShare = 1/2;
      const each = (siblings>0) ? (1/2)/siblings : 0;
      rows.push({ who:"é…å¶", count:1, entitledEach:spouseShare, entitledTotal:spouseShare, reserveEach: spouseShare*reserveMultiplier("spouse") });
      rows.push({ who:"æ¯ä½å…„å¼Ÿå§Šå¦¹", count:siblings, entitledEach:each, entitledTotal:each*siblings, reserveEach: each*reserveMultiplier("siblings") });
    }else if(order === "grandparents"){
      // é…å¶ 2/3ï¼Œç¥–çˆ¶æ¯åˆè¨ˆ 1/3 å¹³åˆ†
      const spouseShare = 2/3;
      const each = (gps>0) ? (1/3)/gps : 0;
      rows.push({ who:"é…å¶", count:1, entitledEach:spouseShare, entitledTotal:spouseShare, reserveEach: spouseShare*reserveMultiplier("spouse") });
      rows.push({ who:"æ¯ä½ç¥–çˆ¶æ¯", count:gps, entitledEach:each, entitledTotal:each*gps, reserveEach: each*reserveMultiplier("grandparents") });
    }else{
      // åªæœ‰é…å¶
      const spouseShare = 1;
      rows.push({ who:"é…å¶", count:1, entitledEach:spouseShare, entitledTotal:spouseShare, reserveEach: spouseShare*reserveMultiplier("spouse") });
    }
  }else{
    // ç„¡é…å¶ï¼šç”±æœ€å‰é †ä½ç¹¼æ‰¿äººå‡åˆ†å…¨éƒ¨
    if(order === "desc"){
      const each = 1/desc;
      rows.push({ who:"æ¯ä½å‘è¦ªå±¬", count:desc, entitledEach:each, entitledTotal:1, reserveEach: each*reserveMultiplier("desc") });
    }else if(order === "parents"){
      const each = 1/parents;
      rows.push({ who:"æ¯ä½çˆ¶æ¯", count:parents, entitledEach:each, entitledTotal:1, reserveEach: each*reserveMultiplier("parents") });
    }else if(order === "siblings"){
      const each = 1/siblings;
      rows.push({ who:"æ¯ä½å…„å¼Ÿå§Šå¦¹", count:siblings, entitledEach:each, entitledTotal:1, reserveEach: each*reserveMultiplier("siblings") });
    }else if(order === "grandparents"){
      const each = 1/gps;
      rows.push({ who:"æ¯ä½ç¥–çˆ¶æ¯", count:gps, entitledEach:each, entitledTotal:1, reserveEach: each*reserveMultiplier("grandparents") });
    }else{
      rows.push({ who:"ï¼ˆç„¡æ³•å®šç¹¼æ‰¿äººï¼‰", count:0, entitledEach:0, entitledTotal:0, reserveEach:0 });
    }
  }

  // è¼¸å‡º
  const out = $("output");
  out.style.display = "block";

  const legalNote = `
    <div class="small muted" style="margin-top:8px">
      æ‡‰ç¹¼åˆ†ï¼ˆé…å¶æ¯”ä¾‹ï¼‰ä¾æ°‘æ³•ç¬¬1144æ¢ï¼šèˆ‡å‘è¦ªå±¬å¹³å‡ï¼›èˆ‡çˆ¶æ¯/å…„å¼Ÿå§Šå¦¹ç‚º1/2ï¼›èˆ‡ç¥–çˆ¶æ¯ç‚º2/3ï¼›ç„¡å…¶ä»–ç¹¼æ‰¿äººå‰‡ç‚ºå…¨éƒ¨ã€‚
    </div>
  `;

  const table = `
    <table class="table">
      <tr>
        <th class="muted">ç¹¼æ‰¿äºº</th>
        <th class="muted">äººæ•¸</th>
        <th class="muted">æ‡‰ç¹¼åˆ†ï¼ˆæ¯äººï¼‰</th>
        <th class="muted">ç‰¹ç•™åˆ†ï¼ˆæ¯äººï¼‰</th>
      </tr>
      ${rows.map(r=>{
        const each = r.entitledEach;
        const res = r.reserveEach;
        // åˆ†æ•¸é¡¯ç¤ºï¼šå°å¸¸è¦‹çš„ 1/2ã€2/3ã€1/(n) é¡¯ç¤ºåˆ†æ•¸æ›´ç›´è¦º
        // é€™è£¡åªåœ¨åˆ†æ¯<=50æ™‚é¡¯ç¤ºåˆ†æ•¸ï¼ˆé¿å…å¤ªé†œï¼‰
        let eachFrac = "";
        let resFrac = "";
        // å˜—è©¦æŠŠ each è½‰æˆåˆ†æ•¸ï¼ˆä»¥ 600 ç‚ºåŸºåº•è¿‘ä¼¼ï¼‰
        eachFrac = approxFraction(each);
        resFrac = approxFraction(res);

        return `
          <tr>
            <td>${r.who}</td>
            <td>${r.count}</td>
            <td>${pct(each)} <span class="muted">(${eachFrac})</span></td>
            <td>${pct(res)} <span class="muted">(${resFrac})</span></td>
          </tr>
        `;
      }).join("")}
    </table>
  `;

  out.innerHTML = `
    <div style="font-weight:800;font-size:16px;margin-bottom:6px">è¨ˆç®—å®Œæˆ</div>
    ${table}
    ${legalNote}
  `;
}

// è¿‘ä¼¼åˆ†æ•¸ï¼šæŠŠå°æ•¸è½‰æˆåˆ†æ•¸ï¼ˆåŸºåº•é™åˆ¶ï¼Œé¿å…é¡¯ç¤ºå¤ªäº‚ï¼‰
function approxFraction(x){
  if(x === 0) return "0";
  if(x === 1) return "1";
  const maxDen = 60;
  let bestN=1, bestD=1, bestErr=Math.abs(x-1);
  for(let d=1; d<=maxDen; d++){
    const n = Math.round(x*d);
    const err = Math.abs(x - (n/d));
    if(err < bestErr){
      bestErr = err; bestN = n; bestD = d;
      if(err < 1e-10) break;
    }
  }
  const g = gcd(bestN, bestD);
  return `${bestN/g}/${bestD/g}`;
}

(function init(){
  resetDefaults();
  // ä»»ä½•è¼¸å…¥è®Šæ›´å°±å…ˆéš±è—çµæœï¼Œé¿å…èª¤è®€
  ["hasSpouse","desc","parents","siblings","grandparents","preset"].forEach(id=>{
    $(id).addEventListener("input", hideOutput);
    $(id).addEventListener("change", hideOutput);
  });
})();
</script>
</body>
</html>
