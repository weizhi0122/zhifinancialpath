<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>è²¡å ±å¥åº·æª¢æ ¸å·¥å…·ï¼ˆç ”ç©¶å®¤ç‰ˆï¼‰ï½œæ™º Financial Path</title>
<meta name="description" content="æ¯”ç‡ï¼‹ç¾é‡‘æµï¼‹åŒæ¥­æ¯”è¼ƒï¼ˆåˆ†ä½æ•¸ï¼‰ï¼‹ç´…æ——æª¢æ ¸ï¼šå¿«é€Ÿæ±ºå®šè¦ä¸è¦é€²ä¼°å€¼ã€‚">
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --text:#333; --muted:#666;
    --line:#e6e8ee; --primary:#0b3d91; --soft:#eef4ff;
    --danger:#d92c2c; --warnbg:#fff4f4; --ok:#15a34a; --okbg:#f1fff5;
  }
  body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.85}
  .topbar{background:#fff;border-bottom:1px solid var(--line);padding:12px 20px;position:sticky;top:0;z-index:10}
  .topbar .inner{max-width:1100px;margin:auto;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:center}
  .topbar a{color:var(--primary);text-decoration:none;font-size:14px}
  .container{max-width:1100px;margin:auto;padding:26px 20px 90px}
  h1,h2,h3{color:var(--primary);margin:0 0 10px}
  .sub{color:#555;margin:0 0 18px}
  .grid{display:grid;grid-template-columns:420px 1fr;gap:14px;align-items:start}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }
  .card{background:var(--card);border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.05);padding:16px}
  label{display:block;font-size:13px;color:#555;margin:10px 0 6px}
  input,select{width:100%;box-sizing:border-box;padding:10px 12px;border:1px solid #d9e2f2;border-radius:12px;background:#fff;font-size:14px}
  input:focus,select:focus{outline:2px solid #cfe0ff;border-color:#cfe0ff}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  @media (max-width:520px){ .row2,.row3{grid-template-columns:1fr} }
  .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{border:0;border-radius:12px;padding:10px 14px;background:var(--primary);color:#fff;cursor:pointer;font-size:14px}
  button.secondary{background:#fff;color:var(--primary);border:1px solid #cfe0ff}
  .kpi{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
  .kpi .box{background:#f7f9ff;border:1px solid #dfeaff;border-radius:14px;padding:12px}
  .kpi .box b{color:var(--primary)}
  .small{font-size:13px;color:var(--muted)}
  .hr{border:none;border-top:1px solid #eef1f6;margin:12px 0}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#f7f9ff;border:1px solid #dfeaff;color:#334155;font-size:12px}
  .msg{border-radius:14px;padding:12px 14px;margin-top:12px}
  .msg.warn{background:var(--warnbg);border-left:4px solid var(--danger)}
  .msg.ok{background:var(--okbg);border-left:4px solid var(--ok)}
  .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:var(--soft);color:var(--primary);font-size:12px}

  /* Radar */
  .radarWrap{border-radius:14px;border:1px solid var(--line);background:#fff;padding:12px}
  canvas{width:100%;height:320px;display:block}

  /* Percent bar */
  .pctWrap{margin-top:10px}
  .pctRow{display:grid;grid-template-columns:130px 1fr 70px;gap:10px;align-items:center;margin:10px 0}
  .pctRow .k{font-size:13px;color:#334155}
  .bar{height:10px;border-radius:999px;background:#eef1f6;position:relative;overflow:hidden}
  .bar > span{position:absolute;left:0;top:0;bottom:0;background:rgba(11,61,145,.25)}
  .dot{position:absolute;top:50%;transform:translate(-50%,-50%);width:12px;height:12px;border-radius:50%;background:var(--primary)}
  .pctRow .v{font-size:12px;color:#0b3d91;text-align:right}
  .help{font-size:12px;color:#7a8699;margin-top:6px;line-height:1.45}
  .footlinks{text-align:center;margin-top:20px}
  .footlinks a{margin:0 10px;color:var(--primary);text-decoration:none}
</style>
</head>
<body>
  <div class="topbar">
    <div class="inner">
      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
        <a href="./tools.html">â† å›å·¥å…·</a>
        <span class="pill">ç ”ç©¶å®¤ç‰ˆï¼šåŒæ¥­æ¯”è¼ƒ + åˆ†ä½æ•¸ + ç´…æ——é–€æª»</span>
      </div>
      <div>
        <a href="./index.html" style="margin-right:12px;">ğŸ  å›ä¸»é </a>
        <a href="./library.html">ğŸ“š çŸ¥è­˜åº«</a>
      </div>
    </div>
  </div>

  <div class="container">
    <h1>è²¡å ±å¥åº·æª¢æ ¸å·¥å…·ï¼ˆç ”ç©¶å®¤ç‰ˆï¼‰</h1>
    <p class="sub">å…ˆåˆ¤æ–·ã€Œé«”è³ªæ˜¯å¦å€¼å¾—ä¼°å€¼ã€ï¼šåˆ†æ•¸è¦çœ‹ã€ç´…æ——æ›´è¦çœ‹ï¼›åŒæ¥­æ¯”è¼ƒå¯ä»¥é¿å…ä½ ç”¨éŒ¯ç”¢æ¥­å¤©èŠ±æ¿ã€‚</p>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <h2 style="margin-top:0">è¼¸å…¥ï¼šå…¬å¸æ•¸å­—</h2>

        <div class="row3">
          <div><label>ç‡Ÿæ”¶å¹´å¢ç‡ï¼ˆ%ï¼‰</label><input id="revG" type="number" step="0.1" value="8"></div>
          <div><label>æ¯›åˆ©ç‡ï¼ˆ%ï¼‰</label><input id="gm" type="number" step="0.1" value="35"></div>
          <div><label>ç‡Ÿæ¥­åˆ©ç›Šç‡ï¼ˆ%ï¼‰</label><input id="om" type="number" step="0.1" value="15"></div>
        </div>

        <div class="row3">
          <div><label>æ·¨åˆ©ç‡ï¼ˆ%ï¼‰</label><input id="nm" type="number" step="0.1" value="10"></div>
          <div><label>ROEï¼ˆ%ï¼‰</label><input id="roe" type="number" step="0.1" value="15"></div>
          <div><label>è² å‚µæ¯”ï¼ˆ%ï¼‰</label><input id="debt" type="number" step="0.1" value="45"></div>
        </div>

        <div class="row2">
          <div><label>æµå‹•æ¯”ç‡ï¼ˆå€ï¼‰</label><input id="cr" type="number" step="0.01" value="1.8"></div>
          <div><label>é€Ÿå‹•æ¯”ç‡ï¼ˆå€ï¼‰</label><input id="qr" type="number" step="0.01" value="1.2"></div>
        </div>

        <div class="row2">
          <div>
            <label>ç‡Ÿé‹ç¾é‡‘æµ / æ·¨åˆ©ï¼ˆå€ï¼‰</label>
            <input id="cfoNI" type="number" step="0.01" value="1.1">
          </div>
          <div>
            <label>è‡ªç”±ç¾é‡‘æµï¼ˆFCFï¼‰ç‚ºæ­£ï¼Ÿ</label>
            <select id="fcfPos">
              <option value="1" selected>æ˜¯</option>
              <option value="0">å¦</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div><label>åˆ©æ¯ä¿éšœå€æ•¸ï¼ˆå€ï¼‰</label><input id="icr" type="number" step="0.1" value="8"></div>
          <div>
            <label>æ‡‰æ”¶å¸³æ¬¾é€±è½‰æ˜¯å¦æƒ¡åŒ–ï¼Ÿ</label>
            <select id="arBad">
              <option value="0" selected>å¦</option>
              <option value="1">æ˜¯</option>
            </select>
          </div>
        </div>

        <div class="hr"></div>

        <h3 style="margin:0 0 6px">åŒæ¥­åƒè€ƒï¼ˆå¯é¸å¡«ï¼‰</h3>
        <div class="small">è‹¥ä½ æœ‰åŒæ¥­å¹³å‡/ä¸­ä½æ•¸ï¼Œå¯ä»¥å¡«é€²ä¾†ï¼Œå·¥å…·æœƒç®—ã€Œç›¸å°ä½ç½®ï¼ˆåˆ†ä½æ•¸ï¼‰ã€ã€‚</div>

        <div class="row2">
          <div>
            <label>åŒæ¥­ ROE ä¸­ä½æ•¸ï¼ˆ%ï¼‰</label>
            <input id="peer_roe" type="number" step="0.1" value="12">
          </div>
          <div>
            <label>åŒæ¥­ è² å‚µæ¯” ä¸­ä½æ•¸ï¼ˆ%ï¼‰</label>
            <input id="peer_debt" type="number" step="0.1" value="50">
          </div>
        </div>

        <div class="row2">
          <div>
            <label>åŒæ¥­ CFO/NI ä¸­ä½æ•¸ï¼ˆå€ï¼‰</label>
            <input id="peer_cfoNI" type="number" step="0.01" value="1.0">
          </div>
          <div>
            <label>åŒæ¥­ æ¯›åˆ©ç‡ ä¸­ä½æ•¸ï¼ˆ%ï¼‰</label>
            <input id="peer_gm" type="number" step="0.1" value="30">
          </div>
        </div>
        <div class="help">æ²’æœ‰è³‡æ–™ä¹Ÿæ²’é—œä¿‚ï¼šåŒæ¥­åˆ†ä½æ•¸å°±é¡¯ç¤ºã€Œâ€”ã€ï¼Œä¸å½±éŸ¿åŸºæœ¬è©•åˆ†ã€‚</div>

        <div class="btnrow">
          <button type="button" onclick="check()">é–‹å§‹æª¢æ ¸</button>
          <button type="button" class="secondary" onclick="resetAll()">é‡è¨­</button>
        </div>

        <div id="msgBox" class="msg" style="display:none"></div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <h2 style="margin-top:0">è¼¸å‡º</h2>

        <div class="kpi">
          <div class="box">
            <b>å¥åº·åº¦ç¸½è©•</b>
            <div id="grade" style="margin-top:6px;">â€”</div>
            <div class="small">Aï¼šé«”è³ªä½³ï½œBï¼šå¯ç ”ç©¶ï½œCï¼šéœ€è¬¹æ…ï½œDï¼šé«˜é¢¨éšª</div>
          </div>
          <div class="box">
            <b>ç´…æ——é–€æª»ï¼ˆå…ˆçœ‹é€™å€‹ï¼‰</b>
            <div id="redflags" style="margin-top:6px;">â€”</div>
            <div class="small">ç´…æ——è¶Šå¤šï¼Œä¼°å€¼è¶Šå®¹æ˜“è®Šæˆè‡ªæˆ‘å®‰æ…°ã€‚</div>
          </div>
          <div class="box">
            <b>ä¼°å€¼å‰ç½®æª¢æ ¸</b>
            <div id="gate" style="margin-top:6px;">â€”</div>
            <div class="small">é€šéæ‰é€²ã€Œä¼°å€¼ï¼‹å®‰å…¨é‚Šéš›ã€ã€‚</div>
          </div>
        </div>

        <div class="hr"></div>

        <h3 style="margin:0 0 6px">åŒæ¥­ç›¸å°ä½ç½®ï¼ˆåˆ†ä½æ•¸ï¼‰</h3>
        <div class="small">ç”¨ã€Œä½  vs åŒæ¥­ä¸­ä½æ•¸ã€ä¼°ç®—ç›¸å°ä½ç½®ï¼ˆç°¡åŒ–ç‰ˆï¼‰ã€‚</div>

        <div class="pctWrap" id="pctWrap"></div>

        <div class="hr"></div>

        <div class="radarWrap">
          <canvas id="radar" width="940" height="320"></canvas>
          <div class="small" style="margin-top:8px">
            é›·é”åœ–è¶Šã€Œé£½æ»¿ã€ä»£è¡¨é«”è³ªè¶Šå‡è¡¡ï¼›ä½†åªè¦æœ‰ä¸€è§’æ·±å‡¹ï¼Œå°±å¯èƒ½æ˜¯æœªçˆ†å½ˆã€‚
          </div>
        </div>

        <div class="note" style="margin-top:12px">
          <span class="badge">ä¸‹ä¸€æ­¥ä½ è¦åšä»€éº¼ï¼Ÿ</span><br>
          <div id="next" style="margin-top:8px">â€”</div>
        </div>
      </div>
    </div>

    <div class="footlinks">
      <a href="./chapter_investing.html">â† å›æŠ•è³‡æ±ºç­–ç³»çµ±</a>
      <a href="./tools.html">å›å·¥å…·</a>
      <a href="./index.html">å›ä¸»é </a>
    </div>
  </div>

<script>
  function clamp(n,min,max){return Math.max(min,Math.min(max,n));}
  function $(id){ return document.getElementById(id); }
  function num(id){ return Number($(id).value || 0); }

  // åŸºæœ¬è©•åˆ†è¦å‰‡ï¼ˆåŒä½ åŸæœ¬é‚è¼¯ï¼Œé›†ä¸­ç®¡ç†ï¼‰
  const RULES = {
    growth: [{min:-999,max:0,score:30},{min:0,max:5,score:55},{min:5,max:15,score:75},{min:15,max:999,score:90}],
    gm:     [{min:-999,max:20,score:35},{min:20,max:35,score:65},{min:35,max:50,score:80},{min:50,max:999,score:90}],
    om:     [{min:-999,max:5,score:30},{min:5,max:12,score:60},{min:12,max:20,score:80},{min:20,max:999,score:90}],
    nm:     [{min:-999,max:3,score:30},{min:3,max:8,score:60},{min:8,max:15,score:80},{min:15,max:999,score:90}],
    roe:    [{min:-999,max:8,score:35},{min:8,max:15,score:70},{min:15,max:25,score:85},{min:25,max:999,score:90}],
    debt:   [{min:-999,max:30,score:90},{min:30,max:50,score:75},{min:50,max:65,score:55},{min:65,max:999,score:35}],
    cr:     [{min:-999,max:1.0,score:35},{min:1.0,max:1.5,score:60},{min:1.5,max:2.5,score:80},{min:2.5,max:999,score:85}],
    qr:     [{min:-999,max:0.8,score:35},{min:0.8,max:1.0,score:60},{min:1.0,max:1.8,score:80},{min:1.8,max:999,score:85}],
    cfoNI:  [{min:-999,max:0.8,score:35},{min:0.8,max:1.0,score:60},{min:1.0,max:1.3,score:80},{min:1.3,max:999,score:90}],
    icr:    [{min:-999,max:2,score:30},{min:2,max:5,score:55},{min:5,max:10,score:80},{min:10,max:999,score:90}],
    weights:{S_growth:0.12,S_profit:0.20,S_quality:0.16,S_leverage:0.14,S_liquidity:0.12,S_cashflow:0.18,S_interest:0.08}
  };

  function scoreRange(v, rules){
    for(const r of rules){ if(v>=r.min && v<r.max) return r.score; }
    return 0;
  }

  // åˆ†ä½æ•¸ï¼ˆç°¡åŒ–ç‰ˆï¼‰ï¼šç”¨ä½  vs åŒæ¥­ä¸­ä½æ•¸ï¼Œåšä¸€å€‹ S å‹è¿‘ä¼¼è½‰æ›
  // > ä¸­ä½æ•¸å¾ˆå¤šï¼š>50%ï¼›é å¤§æ–¼ä¸­ä½æ•¸ï¼šæ¥è¿‘ 90%ï¼›é å°ï¼šæ¥è¿‘ 10%
  function approxPercentile(value, median, direction){
    // direction: "higherBetter" or "lowerBetter"
    if(!isFinite(value) || !isFinite(median) || median===0) return null;

    // æŠŠã€Œè¶Šå¤§è¶Šå¥½ã€è½‰æˆåŒå‘æ¯”è¼ƒ
    let ratio = (direction==="higherBetter") ? (value/median) : (median/value);

    // é¿å…çˆ†ç‚¸
    ratio = clamp(ratio, 0.2, 5);

    // logistic-ish map: ratio=1 -> 50
    // ratio=0.5 -> ~20-30 ; ratio=2 -> ~70-80
    const x = Math.log(ratio); // -..+
    const pct = 100 * (1 / (1 + Math.exp(-1.4 * x))); // slope
    return clamp(pct, 1, 99);
  }

  function pctRow(label, pct){
    const safe = (pct===null) ? "â€”" : `${pct.toFixed(0)}%`;
    const w = (pct===null) ? 0 : pct;
    const dotLeft = (pct===null) ? 0 : pct;

    return `
      <div class="pctRow">
        <div class="k">${label}</div>
        <div class="bar">
          <span style="width:${w}%;"></span>
          ${pct===null ? "" : `<i class="dot" style="left:${dotLeft}%;"></i>`}
        </div>
        <div class="v">${safe}</div>
      </div>
    `;
  }

  function check(){
    const revG = num('revG'), gm=num('gm'), om=num('om'), nm=num('nm'), roe=num('roe');
    const debt = num('debt'), cr=num('cr'), qr=num('qr'), cfoNI=num('cfoNI');
    const fcfPos = Number($('fcfPos').value||0);
    const icr = num('icr');
    const arBad = Number($('arBad').value||0);

    // åŸºæœ¬åˆ†æ•¸
    const S_growth = clamp(scoreRange(revG, RULES.growth),0,100);
    const S_profit = clamp(
      scoreRange(gm, RULES.gm)*0.40 +
      scoreRange(om, RULES.om)*0.35 +
      scoreRange(nm, RULES.nm)*0.25
    ,0,100);
    const S_quality = clamp(scoreRange(roe, RULES.roe)*0.60 + ((arBad>=1)?30:85)*0.40,0,100);
    const S_leverage = clamp(scoreRange(debt, RULES.debt),0,100);
    const S_liquidity = clamp(scoreRange(cr, RULES.cr)*0.55 + scoreRange(qr, RULES.qr)*0.45,0,100);
    const S_cashflow = clamp(scoreRange(cfoNI, RULES.cfoNI)*0.65 + ((fcfPos>=1)?85:40)*0.35,0,100);
    const S_interest = clamp(scoreRange(icr, RULES.icr),0,100);

    const W = RULES.weights;
    const overall = S_growth*W.S_growth + S_profit*W.S_profit + S_quality*W.S_quality + S_leverage*W.S_leverage +
                    S_liquidity*W.S_liquidity + S_cashflow*W.S_cashflow + S_interest*W.S_interest;

    let gradeTxt='Bï¼ˆå¯ç ”ç©¶ï¼‰';
    if(overall>=82) gradeTxt='Aï¼ˆé«”è³ªä½³ï¼‰';
    else if(overall>=70) gradeTxt='Bï¼ˆå¯ç ”ç©¶ï¼‰';
    else if(overall>=58) gradeTxt='Cï¼ˆéœ€è¬¹æ…ï¼‰';
    else gradeTxt='Dï¼ˆé«˜é¢¨éšªï¼‰';

    $('grade').innerHTML = `<b style="font-size:22px;color:#0b3d91">${gradeTxt}</b><div class="small">ç¸½åˆ†ï¼š${overall.toFixed(1)} / 100</div>`;

    // ç´…æ——ï¼ˆå¯æ“´å……ï¼‰
    const red = [];
    if(icr < 2) red.push("åˆ©æ¯ä¿éšœ < 2ï¼ˆå‚µå‹™å£“åŠ›é«˜ï¼‰");
    if(cfoNI < 0.8) red.push("CFO/æ·¨åˆ© < 0.8ï¼ˆç›ˆé¤˜å“è³ªåå¼±ï¼‰");
    if(debt > 65) red.push("è² å‚µæ¯” > 65%ï¼ˆæ§“æ¡¿åé«˜ï¼‰");
    if(fcfPos === 0) red.push("FCF ç‚ºè² ï¼ˆéœ€ç¢ºèªè³‡æœ¬æ”¯å‡º/ç‡’éŒ¢ï¼‰");
    if(arBad === 1) red.push("æ‡‰æ”¶é€±è½‰æƒ¡åŒ–ï¼ˆå›æ¬¾é¢¨éšªï¼‰");

    $('redflags').innerHTML = red.length ? `<ul>${red.map(x=>`<li>${x}</li>`).join("")}</ul>` : `<b>ç›®å‰æœªçœ‹åˆ°æ˜é¡¯ç´…æ——</b><div class="small">ä»å»ºè­°çœ‹é™„è¨»ç¢ºèªä¸€æ¬¡æ€§å› ç´ ã€‚</div>`;

    // ä¼°å€¼å‰ç½®æª¢æ ¸ï¼ˆGateï¼‰
    let gate = "âœ… é€šéï¼šå¯é€²ä¼°å€¼";
    let gateHint = "ä¸‹ä¸€æ­¥å»ºè­°ï¼šåšåŒæ¥­æ¯”è¼ƒï¼ˆæ¯›åˆ©/è²»ç”¨ç‡/ROE/ç¾é‡‘æµï¼‰ï¼‹å†é€²ä¼°å€¼ï¼ˆå®‰å…¨é‚Šéš›ï¼‰ã€‚";
    if(red.length>=2 || overall<58){
      gate = "âš ï¸ æš«ç·©ï¼šå…ˆè£œè­‰æ“šå†ä¼°å€¼";
      gateHint = "ç´…æ——åå¤šæˆ–ç¸½åˆ†åä½ï¼šå…ˆå›ç­”ã€çŸ­æœŸé€±æœŸ vs çµæ§‹æ€§å•é¡Œã€ï¼Œä¸è¦æ€¥è‘—ç”¨ä¼°å€¼å®‰æ…°è‡ªå·±ã€‚";
    }
    $('gate').innerHTML = `<b>${gate}</b><div class="small">${gateHint}</div>`;

    // åŒæ¥­åˆ†ä½ï¼ˆç°¡åŒ–ï¼‰
    const peer_roe = num('peer_roe');
    const peer_debt= num('peer_debt');
    const peer_cfoNI= num('peer_cfoNI');
    const peer_gm= num('peer_gm');

    const p1 = approxPercentile(roe, peer_roe, "higherBetter");
    const p2 = approxPercentile(debt, peer_debt, "lowerBetter");
    const p3 = approxPercentile(cfoNI, peer_cfoNI, "higherBetter");
    const p4 = approxPercentile(gm, peer_gm, "higherBetter");

    $('pctWrap').innerHTML =
      pctRow("ROEï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰", p1) +
      pctRow("è² å‚µæ¯”ï¼ˆè¶Šä½è¶Šå¥½ï¼‰", p2) +
      pctRow("CFO/æ·¨åˆ©ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰", p3) +
      pctRow("æ¯›åˆ©ç‡ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰", p4);

    // next stepsï¼ˆæ›´åƒç ”ç©¶æµç¨‹ï¼‰
    const nextList = [];
    if(red.length){
      nextList.push(`<li><b>å…ˆè™•ç†ç´…æ——ï¼š</b>æŠŠç´…æ——æ¯ä¸€é …éƒ½æ‰¾åˆ°ã€Œé™„è¨»/æ˜ç´°ã€è­‰æ“šï¼Œåˆ¤æ–·å¯é€†/ä¸å¯é€†ã€‚</li>`);
    }else{
      nextList.push(`<li><b>é«”è³ªå¤§è‡´éé—œï¼š</b>åšåŒæ¥­æ¯”è¼ƒï¼Œç¢ºèªä¸æ˜¯ç”¢æ¥­å¤©èŠ±æ¿é™åˆ¶ã€‚</li>`);
    }
    nextList.push(`<li><b>å†åšä¼°å€¼ï¼š</b>ä½¿ç”¨ä½ çš„ä¼°å€¼å·¥å…·ï¼ˆEPS/FCF/æŠ˜ç¾/å®‰å…¨é‚Šéš›ï¼‰ï¼Œä¸¦ç”¨ä¿å®ˆæƒ…å¢ƒé‡ç®—ã€‚</li>`);
    nextList.push(`<li><b>æœ€å¾Œæ”¾å›é…ç½®ï¼š</b>ä¾é¢¨éšªèˆ‡æŠŠæ¡åº¦æ±ºå®šéƒ¨ä½å¤§å°ï¼Œè€Œä¸æ˜¯åªçœ‹ä¾¿å®œã€‚</li>`);
    $('next').innerHTML = `<ul>${nextList.join("")}</ul>`;

    // Radar
    drawRadar([S_growth,S_profit,S_quality,S_leverage,S_liquidity,S_cashflow,S_interest]);

    // Message
    const msgBox = $('msgBox');
    msgBox.style.display="block";
    if(red.length>=2 || overall<58){
      msgBox.className="msg warn";
      msgBox.innerHTML = `<b>æé†’ï¼š</b>å…ˆåˆ¥æ€¥è‘—ä¼°å€¼ã€‚ä½ ç¾åœ¨æœ€é‡è¦çš„æ˜¯ã€ŒæŠŠé¢¨éšªè®Šæˆå¯é©—è­‰çš„å•é¡Œã€ã€‚`;
    }else{
      msgBox.className="msg ok";
      msgBox.innerHTML = `<b>æç¤ºï¼š</b>å¯ä»¥é€²ç¬¬äºŒé—œï¼ˆä¼°å€¼ï¼‹å®‰å…¨é‚Šéš›ï¼‰äº†ï¼Œä½†ä»è¦ç”¨å£æƒ…å¢ƒé‡ç®—ä¸€æ¬¡ã€‚`;
    }
  }

  function drawRadar(vals){
    const c=$('radar');
    const ctx=c.getContext('2d');
    const W=c.width, H=c.height;
    ctx.clearRect(0,0,W,H);

    const labels=['æˆé•·','ç²åˆ©','å“è³ª','æ§“æ¡¿','æµå‹•','ç¾é‡‘æµ','åˆ©æ¯'];
    const cx=W/2, cy=H/2+10;
    const R=Math.min(W,H)*0.33;

    ctx.strokeStyle='#d7deea'; ctx.lineWidth=2;
    for(let lv=1; lv<=4; lv++){
      const r=R*(lv/4);
      ctx.beginPath();
      for(let i=0;i<labels.length;i++){
        const ang=(-Math.PI/2) + i*(2*Math.PI/labels.length);
        const x=cx + r*Math.cos(ang);
        const y=cy + r*Math.sin(ang);
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.closePath(); ctx.stroke();
    }

    ctx.fillStyle='#555'; ctx.font='12px Arial';
    for(let i=0;i<labels.length;i++){
      const ang=(-Math.PI/2) + i*(2*Math.PI/labels.length);
      const x=cx + (R+20)*Math.cos(ang);
      const y=cy + (R+20)*Math.sin(ang);
      ctx.strokeStyle='#c9d3e5'; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx+R*Math.cos(ang), cy+R*Math.sin(ang)); ctx.stroke();
      ctx.fillText(labels[i], x-12, y+4);
    }

    ctx.fillStyle='rgba(11,61,145,0.12)';
    ctx.strokeStyle='#0b3d91'; ctx.lineWidth=3;
    ctx.beginPath();
    for(let i=0;i<vals.length;i++){
      const ang=(-Math.PI/2) + i*(2*Math.PI/vals.length);
      const r=R*(vals[i]/100);
      const x=cx + r*Math.cos(ang);
      const y=cy + r*Math.sin(ang);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.fill(); ctx.stroke();

    ctx.fillStyle='#0b3d91';
    for(let i=0;i<vals.length;i++){
      const ang=(-Math.PI/2) + i*(2*Math.PI/vals.length);
      const r=R*(vals[i]/100);
      const x=cx + r*Math.cos(ang);
      const y=cy + r*Math.sin(ang);
      ctx.beginPath(); ctx.arc(x,y,4,0,2*Math.PI); ctx.fill();
    }

    ctx.fillStyle='#666'; ctx.font='13px Arial';
    ctx.fillText('é›·é”åœ–ï¼šä¸ƒå¤§é«”è³ªç¶­åº¦ï¼ˆ0~100ï¼‰', 18, 22);
  }

  function resetAll(){
    $('revG').value=8; $('gm').value=35; $('om').value=15;
    $('nm').value=10; $('roe').value=15; $('debt').value=45;
    $('cr').value=1.8; $('qr').value=1.2; $('cfoNI').value=1.1;
    $('fcfPos').value=1; $('icr').value=8; $('arBad').value=0;

    $('peer_roe').value=12; $('peer_debt').value=50; $('peer_cfoNI').value=1.0; $('peer_gm').value=30;

    $('grade').innerHTML='â€”'; $('redflags').innerHTML='â€”'; $('gate').innerHTML='â€”';
    $('pctWrap').innerHTML=''; $('next').innerHTML='â€”';
    const c=$('radar'); c.getContext('2d').clearRect(0,0,c.width,c.height);
    $('msgBox').style.display="none";
    check();
  }

  check();
</script>
</body>
</html>
