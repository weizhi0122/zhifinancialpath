<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>å‹ä¿è€å¹´çµ¦ä»˜è©¦ç®—ï½œæ™º Financial Path</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="å‹ä¿è€å¹´å¹´é‡‘ï¼ä¸€æ¬¡é‡‘è©¦ç®—ï¼šè¼¸å…¥å¹´è³‡ã€è«‹é ˜å¹´é½¡ã€æŠ•ä¿è–ªè³‡æ˜ç´°ï¼Œè‡ªå‹•æŠ“æœ€é«˜60å€‹æœˆå¹³å‡ä¸¦ä¾ç¾è¡Œå…¬å¼è¨ˆç®—ï¼ˆæ•™è‚²ç”¨é€”ï¼‰ã€‚" />
<style>
  :root{
    --bg:#f6f8fb; --card:#fff; --text:#222; --muted:#667085;
    --line:#e6e8ee; --primary:#0b3d91; --soft:#eef4ff;
    --warnbg:#fff4e5; --warn:#8a5300;
    --goodbg:#ecfdf3; --good:#027a48;
  }
  body{font-family:Arial,"Noto Sans TC",sans-serif;margin:0;background:var(--bg);color:var(--text)}
  a{color:var(--primary);text-decoration:none}
  a:hover{text-decoration:underline}

  .topbar{
    background:#fff;border-bottom:1px solid var(--line);
    padding:10px 18px; position:sticky; top:0; z-index:100;
  }
  .topbar-inner{
    max-width:1100px;margin:auto;
    display:flex;justify-content:space-between;align-items:center;gap:12px;
  }
  .left-nav{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
  .brand{font-size:13px;color:var(--muted)}
  .container{max-width:1100px;margin:auto;padding:22px 18px}
  h1{margin:0 0 10px;color:var(--primary);font-size:26px}
  .grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media (min-width:980px){ .grid{grid-template-columns:1.2fr 0.8fr} }

  .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .card h2{margin:0 0 10px;font-size:16px;color:#0f172a}
  label{display:block;margin-top:10px;font-size:14px;color:#0f172a}
  input,select,textarea,button{
    width:100%;padding:10px 10px;margin-top:6px;border:1px solid #d7dbe6;border-radius:10px;
    box-sizing:border-box;background:#fff;font-size:14px;
  }
  textarea{min-height:140px;resize:vertical;line-height:1.35}
  .row{display:flex;gap:10px}
  .row > *{flex:1}
  button{margin-top:14px;background:var(--primary);color:#fff;border:0;cursor:pointer;font-weight:800}
  button.secondary{background:#334155}
  .result{margin-top:14px;padding:14px;border-radius:12px;background:var(--soft);color:var(--primary);display:none}
  .warn{display:none;margin-top:10px;padding:10px 12px;border-radius:12px;background:var(--warnbg);color:var(--warn);border:1px solid #ffe2b5;font-size:13px;line-height:1.4}
  .ok{display:none;margin-top:10px;padding:10px 12px;border-radius:12px;background:var(--goodbg);color:var(--good);border:1px solid #b7f0cc;font-size:13px;line-height:1.4}
  .small{font-size:12.5px;color:var(--muted);line-height:1.45;margin-top:10px}
  .pill{display:inline-block;font-size:12px;padding:4px 8px;border-radius:999px;background:#f1f5ff;color:var(--primary);border:1px solid #dbe7ff}
  .table{width:100%;border-collapse:collapse;margin-top:10px}
  .table th,.table td{padding:7px 0;border-bottom:1px dashed #dbe2f0;font-size:13.5px}
  .table th{text-align:left;color:#0f172a}
  .table td:last-child,.table th:last-child{text-align:right}
  .muted{color:var(--muted)}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  .chip{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #dbe2f0;color:#334155;background:#f8fafc;font-size:12px;margin-left:6px}
</style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="left-nav">
        <a href="./tools.html">â† å›å·¥å…·</a>
        <a href="./index.html">ğŸ  å›ä¸»é </a>
      </div>
      <div class="brand">æ™º Financial Path</div>
    </div>
  </div>

  <div class="container">
    <h1>å‹ä¿è€å¹´çµ¦ä»˜è©¦ç®— <span class="pill">æ›´çœŸå¯¦ï¼šè²¼æŠ•ä¿è–ªè³‡æ˜ç´°ï¼Œè‡ªå‹•æŠ“æœ€é«˜60å€‹æœˆå¹³å‡</span></h1>

    <div class="grid">
      <!-- å·¦ï¼šè¼¸å…¥ -->
      <div class="card">
        <h2>1) ä½ çš„è³‡æ–™</h2>

        <div class="row">
          <div>
            <label>å‡ºç”Ÿå¹´æ¬¡ï¼ˆæ°‘åœ‹ï¼‰</label>
            <input id="birthRoc" type="number" min="1" step="1" value="60" />
            <div class="small">ä¾‹ï¼šæ°‘åœ‹60å¹´</div>
          </div>
          <div>
            <label>é è¨ˆè«‹é ˜å¹´é½¡</label>
            <div class="row">
              <div>
                <input id="claimYears" type="number" min="0" step="1" value="65" />
                <div class="small">æ­²</div>
              </div>
              <div>
                <input id="claimMonths" type="number" min="0" max="11" step="1" value="0" />
                <div class="small">æœˆ</div>
              </div>
            </div>
          </div>
        </div>

        <label>å‹ä¿å¹´è³‡ï¼ˆæ›´çœŸå¯¦ï¼šå¯å¡«åˆ°ã€Œå¤©ã€ï¼›æœªæ»¿30æ—¥ä»¥1å€‹æœˆè¨ˆï¼‰</label>
        <div class="row">
          <div>
            <input id="insYears" type="number" min="0" step="1" value="30" />
            <div class="small">å¹´</div>
          </div>
          <div>
            <input id="insMonths" type="number" min="0" max="11" step="1" value="0" />
            <div class="small">æœˆ</div>
          </div>
          <div>
            <input id="insDays" type="number" min="0" max="30" step="1" value="0" />
            <div class="small">å¤©ï¼ˆ1~29è¦–ç‚º+1æœˆï¼›30ä¹Ÿè¦–ç‚º+1æœˆï¼‰</div>
          </div>
        </div>

        <hr style="border:0;border-top:1px solid var(--line);margin:14px 0" />

        <h2>2) æŠ•ä¿è–ªè³‡æ˜ç´°ï¼ˆç”¨ä¾†ç®—ã€Œæœ€é«˜60å€‹æœˆå¹³å‡ã€ï¼‰</h2>
        <div class="small">
          ä½ å¯ä»¥ç”¨å…©ç¨®æ–¹å¼æ“‡ä¸€ï¼š<br/>
          A) è²¼ã€ŒæœˆæŠ•ä¿è–ªè³‡åºåˆ—ã€ï¼ˆåªè²¼é‡‘é¡ï¼Œä¸€è¡Œä¸€å€‹æœˆï¼‰<span class="chip">æœ€å¿«</span><br/>
          B) è²¼ã€ŒYYYY-MM é‡‘é¡ã€æˆ–ã€ŒYYYY/MM é‡‘é¡ã€ï¼Œä¾‹å¦‚ï¼š<span class="mono">2024-01 45800</span>
        </div>

        <label>æŠ•ä¿è–ªè³‡æ˜ç´°ï¼ˆè‡³å°‘å¡« 1 è¡Œï¼›å»ºè­°è²¼ 60 è¡Œä»¥ä¸Šï¼‰</label>
        <textarea id="salaryLines" placeholder="ä¾‹ï¼š
45800
45800
...
æˆ–ï¼š
2024-01 45800
2024-02 45800"></textarea>

        <div class="row">
          <button onclick="calcAll()">è¨ˆç®—ï¼ˆå¹´é‡‘ / ä¸€æ¬¡é‡‘ï¼‰</button>
          <button class="secondary" onclick="loadExample()">å¸¶å…¥ç¯„ä¾‹</button>
        </div>

        <div id="warnBox" class="warn"></div>
        <div id="okBox" class="ok"></div>

        <p class="small">
          â€» æ•™è‚²ç”¨é€”ï¼šå¯¦éš›æ ¸ä»˜ä»ä»¥å‹ä¿å±€è³‡æ–™ç‚ºæº–ã€‚è‹¥ä½ çš„æŠ•ä¿è–ªè³‡æœ‰ç©ºçª—ã€ä¸åŒå·¥ä½œã€æˆ–éæ¯æœˆéƒ½æœ‰æŠ•ä¿ï¼Œè«‹ç›¡é‡è²¼ä¸Šå¯¦éš›æœˆè³‡æ–™ï¼Œçµæœæœƒæ›´æ¥è¿‘ã€‚
        </p>
      </div>

      <!-- å³ï¼šçµæœ -->
      <div class="card">
        <h2>çµæœ</h2>
        <div id="output" class="result"></div>
      </div>
    </div>
  </div>

<script>
/** ========= æ ¸å¿ƒè¦å‰‡ï¼ˆä¾å‹ä¿å±€ç¾è¡Œèªªæ˜ï¼‰ =========
 * è€å¹´å¹´é‡‘ï¼šå…©å¼æ“‡å„ª
 * â‘  å¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— å¹´è³‡ Ã— 0.775% + 3,000
 * â‘¡ å¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— å¹´è³‡ Ã— 1.55%
 * ææ—©/å±•å»¶ï¼šæ¯å¹´ Â±4%ï¼Œæœ€å¤š Â±20%ï¼Œæœªæ»¿1å¹´æŒ‰æœˆæ¯”ä¾‹
 * å¹³å‡æœˆæŠ•ä¿è–ªè³‡ï¼šåŠ ä¿æœŸé–“ã€Œæœ€é«˜60å€‹æœˆã€å¹³å‡ï¼›æœªæ»¿5å¹´å‰‡ç”¨å¯¦éš›æŠ•ä¿æœŸé–“å¹³å‡
 * å¹´è³‡æœªæ»¿1å¹´æŒ‰æœˆæ¯”ä¾‹ï¼›æœªæ»¿30æ—¥è€…ä»¥1å€‹æœˆè¨ˆ
 */
const RULES = {
  // æ³•å®šè«‹é ˜å¹´é½¡ï¼ˆä¾å‡ºç”Ÿå¹´æ¬¡ï¼š46(å«)ä»¥å‰=60ã€47=61ã€48=62ã€49=63ã€50=64ã€51(å«)ä»¥å¾Œ=65ï¼‰
  legalAgeByBirthRoc: (roc) => {
    if (roc <= 46) return { years: 60, months: 0 };
    if (roc === 47) return { years: 61, months: 0 };
    if (roc === 48) return { years: 62, months: 0 };
    if (roc === 49) return { years: 63, months: 0 };
    if (roc === 50) return { years: 64, months: 0 };
    return { years: 65, months: 0 }; // 51(å«)ä»¥å¾Œ
  },
  maxAdjYears: 5,
  adjPerYear: 0.04
};

function $(id){ return document.getElementById(id); }

function clampInt(v){
  if(!Number.isFinite(v)) return NaN;
  return Math.max(0, Math.floor(v));
}

function parseMoneyStr(s){
  const cleaned = (s||"").toString().trim().replace(/[,ï¼Œ]/g,"");
  if(!cleaned) return NaN;
  const n = Number(cleaned);
  return Number.isFinite(n) ? n : NaN;
}

function fmt(n){
  try { return Number(n).toLocaleString("en-US"); } catch { return String(n); }
}

function showWarn(msg){
  const w = $("warnBox");
  if(!msg){ w.style.display="none"; w.textContent=""; return; }
  w.style.display="block"; w.textContent = msg;
}
function showOk(msg){
  const o = $("okBox");
  if(!msg){ o.style.display="none"; o.textContent=""; return; }
  o.style.display="block"; o.textContent = msg;
}
function hideOutput(){
  $("output").style.display="none";
  $("output").innerHTML="";
}

function ageToMonths(y,m){
  return clampInt(y)*12 + clampInt(m);
}

/** ææ—©/å±•å»¶åŠ æ¸›çµ¦ï¼šæ¯å¹´Â±4%ï¼ˆæœªæ»¿1å¹´æŒ‰æœˆæ¯”ä¾‹ï¼‰ï¼Œæœ€å¤šÂ±20% */
function adjustFactor(legalMonths, claimMonths){
  const diffMonths = claimMonths - legalMonths; // >0 å±•å»¶, <0 ææ—©
  const rawYears = diffMonths / 12;
  const cappedYears = Math.max(-RULES.maxAdjYears, Math.min(RULES.maxAdjYears, rawYears));
  const factor = 1 + cappedYears * RULES.adjPerYear;
  return { factor, diffMonths, rawYears, cappedYears };
}

/** å¹´è³‡ï¼šå¹´/æœˆ/å¤© -> ä»¥ã€Œæœˆã€ç‚ºæœ€å°å–®ä½ï¼ˆå¤©>0 è¦–ç‚º+1æœˆï¼‰ */
function insToMonths(years, months, days){
  const y = clampInt(years), m = clampInt(months), d = clampInt(days);
  if([y,m,d].some(v => !Number.isFinite(v))) return NaN;
  if(m > 11) return NaN;
  if(d > 30) return NaN;
  const extraMonth = (d > 0) ? 1 : 0; // æœªæ»¿30æ—¥ï¼Œä»¥1å€‹æœˆè¨ˆï¼ˆ>0å°±+1ï¼‰
  return y*12 + m + extraMonth;
}

/** è§£ææŠ•ä¿è–ªè³‡æ˜ç´°
 * æ”¯æ´ï¼š
 * - ä¸€è¡Œä¸€å€‹é‡‘é¡
 * - æˆ– YYYY-MM é‡‘é¡ / YYYY/MM é‡‘é¡
 */
function parseSalaryLines(text){
  const lines = (text||"").split(/\r?\n/).map(x=>x.trim()).filter(Boolean);

  const items = [];
  for(const line of lines){
    // å…è¨±ï¼š2024-01 45800 / 2024/01 45800 / 2024-01,45800
    const m = line.match(/^(\d{4})[\/\-](\d{1,2})[^\d]+([\d,ï¼Œ]+(\.\d+)?)$/);
    if(m){
      const yyyy = Number(m[1]);
      const mm = Number(m[2]);
      const salary = parseMoneyStr(m[3]);
      if(!Number.isFinite(yyyy) || !Number.isFinite(mm) || mm<1 || mm>12 || !Number.isFinite(salary) || salary<=0) continue;
      // ç”¨ yyyy*12+mm åšæ’åº key
      const key = yyyy*12 + mm;
      items.push({ key, salary, raw: line });
      continue;
    }

    // åªå¡«é‡‘é¡
    const salary = parseMoneyStr(line);
    if(Number.isFinite(salary) && salary>0){
      items.push({ key: null, salary, raw: line });
    }
  }

  // è‹¥æœ‰æ—¥æœŸ keyï¼šä¾æœˆä»½æ’åºï¼›åŒæœˆé‡è¤‡ä¿ç•™æœ€å¾Œä¸€ç­†
  const hasKey = items.some(x => x.key !== null);
  if(hasKey){
    const map = new Map();
    for(const it of items){
      if(it.key === null) continue; // æ··ç”¨æ™‚ï¼Œæ²’æœ‰æ—¥æœŸçš„å¿½ç•¥ï¼ˆé¿å…æ±¡æŸ“ï¼‰
      map.set(it.key, it.salary);
    }
    const arr = [...map.entries()].sort((a,b)=>a[0]-b[0]).map(([key,salary])=>({key,salary}));
    return { mode:"dated", salaries: arr.map(x=>x.salary), count: arr.length };
  }

  // ç„¡æ—¥æœŸï¼šä»¥è¼¸å…¥é †åºè¦–ç‚ºæ™‚é–“åºåˆ—
  return { mode:"sequence", salaries: items.map(x=>x.salary), count: items.length };
}

/** å¹³å‡æœˆæŠ•ä¿è–ªè³‡ï¼šåŠ ä¿æœŸé–“æœ€é«˜60å€‹æœˆå¹³å‡ï¼›æœªæ»¿5å¹´(60å€‹æœˆ)å‰‡ç”¨å…¨éƒ¨å¹³å‡ */
function calcAvgTop60(salaries){
  if(!salaries || salaries.length === 0) return { avg: NaN, used: [], rule: "" };

  const n = salaries.length;
  const rule = (n < 60)
    ? "æœªæ»¿5å¹´ï¼šä»¥å¯¦éš›æŠ•ä¿æœŸé–“å¹³å‡"
    : "æœ€é«˜60å€‹æœˆå¹³å‡";

  if(n < 60){
    const sum = salaries.reduce((a,b)=>a+b,0);
    return { avg: sum/n, used: salaries.slice(), rule };
  }

  // å–æœ€é«˜60å€‹æœˆ
  const sorted = salaries.slice().sort((a,b)=>b-a);
  const top60 = sorted.slice(0,60);
  const sum = top60.reduce((a,b)=>a+b,0);
  return { avg: sum/60, used: top60, rule };
}

/** è€å¹´å¹´é‡‘ï¼šå…©å¼æ“‡å„ªï¼Œä¸¦ä¾åŠ æ¸›çµ¦èª¿æ•´ */
function calcPension(avgSalary, insMonths, factor){
  const insYears = insMonths / 12;

  // åŸºç¤ï¼ˆæœªåŠ æ¸›çµ¦ï¼‰
  const base1 = avgSalary * insYears * 0.00775 + 3000;
  const base2 = avgSalary * insYears * 0.0155;

  const chosenBase = Math.max(base1, base2);
  const chosen = (base1 >= base2)
    ? "ç¬¬1å¼ï¼šå¹³å‡æœˆæŠ•ä¿è–ªè³‡Ã—å¹´è³‡Ã—0.775%ï¼‹3,000"
    : "ç¬¬2å¼ï¼šå¹³å‡æœˆæŠ•ä¿è–ªè³‡Ã—å¹´è³‡Ã—1.55%";

  const finalMonthly = Math.round(chosenBase * factor);

  return { base1, base2, chosenBase, chosen, finalMonthly, insYears };
}

/** è€å¹´ä¸€æ¬¡é‡‘ï¼ˆå¹´è³‡ä¸è¶³15å¹´å¸¸ç”¨ï¼‰
 * çµ¦ä»˜é‡‘é¡ = å¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— çµ¦ä»˜æœˆæ•¸
 * çµ¦ä»˜æœˆæ•¸ï¼ˆç°¡åŒ–ç‰ˆï¼‰ï¼šå¹´è³‡æ¯æ»¿1å¹´ç™¼çµ¦1å€‹æœˆï¼ˆä¸è¶³1å¹´æŒ‰æ¯”ä¾‹ã€æœªæ»¿30æ—¥ä»¥1å€‹æœˆè¨ˆï¼‰
 * â€» æ³¨æ„ï¼šå¯¦å‹™é‚„æœ‰ã€Œé€¾60æ­²ç¹¼çºŒå·¥ä½œè€…ï¼Œé€¾60æ­²ä»¥å¾Œå¹´è³‡æœ€å¤šè¨ˆ5å¹´ã€ç­‰ç´°ç¯€ï¼ˆæ­¤è™•ä¸åšæ‹†åˆ†ï¼Œæé†’å³å¯ï¼‰
 */
function calcLumpSum(avgSalary, insMonths){
  // ä»¥æœˆç‚ºå–®ä½ï¼šinsMonths/12 å€‹æœˆï¼ˆæ¯å¹´=1å€‹æœˆï¼‰
  const benefitMonths = insMonths / 12;
  const amount = Math.round(avgSalary * benefitMonths);
  return { benefitMonths, amount };
}

function calcAll(){
  showWarn("");
  showOk("");
  hideOutput();

  const roc = Number($("birthRoc").value);
  const claimY = clampInt(Number($("claimYears").value));
  const claimM = clampInt(Number($("claimMonths").value));
  const insY = clampInt(Number($("insYears").value));
  const insM = clampInt(Number($("insMonths").value));
  const insD = clampInt(Number($("insDays").value));

  if(!Number.isFinite(roc) || roc<=0){ alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å‡ºç”Ÿå¹´æ¬¡ï¼ˆæ°‘åœ‹ï¼‰"); return; }
  if(!Number.isFinite(claimY) || !Number.isFinite(claimM) || claimM>11){ alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„è«‹é ˜å¹´é½¡ï¼ˆæœˆä»½ 0~11ï¼‰"); return; }
  if(!Number.isFinite(insY) || !Number.isFinite(insM) || !Number.isFinite(insD) || insM>11 || insD>30){
    alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å¹´è³‡ï¼ˆæœˆä»½ 0~11ã€å¤©æ•¸ 0~30ï¼‰");
    return;
  }

  const insMonthsTotal = insToMonths(insY, insM, insD);
  if(!Number.isFinite(insMonthsTotal) || insMonthsTotal<=0){
    alert("å¹´è³‡éœ€å¤§æ–¼ 0");
    return;
  }

  const salParsed = parseSalaryLines($("salaryLines").value);
  if(!salParsed.count){
    alert("è«‹è‡³å°‘è¼¸å…¥ 1 ç­†æŠ•ä¿è–ªè³‡æ˜ç´°");
    return;
  }

  // æ›´çœŸå¯¦ï¼šè‹¥ä½ è²¼çš„æœˆæ•¸ < ä½ å¡«çš„å¹´è³‡æœˆæ•¸ï¼Œæé†’ï¼ˆä¸å¼·åˆ¶ï¼‰
  if(salParsed.count < insMonthsTotal){
    showWarn(`ä½ è²¼çš„æŠ•ä¿è–ªè³‡æœˆæ•¸ï¼ˆ${salParsed.count}ï¼‰å°æ–¼ä½ å¡«çš„å¹´è³‡æœˆæ•¸ï¼ˆ${insMonthsTotal}ï¼‰ã€‚è‹¥ä¸­é–“æœ‰ç©ºçª—æˆ–æœªæŠ•ä¿æ²’é—œä¿‚ï¼›ä½†è‹¥å…¶å¯¦æ¯æœˆéƒ½æœ‰æŠ•ä¿ï¼Œå»ºè­°è²¼æ»¿æœƒæ›´æº–ã€‚`);
  }else{
    showOk(`å·²è®€å– ${salParsed.count} ç­†æŠ•ä¿è–ªè³‡è³‡æ–™ï¼ˆ${salParsed.mode==="dated" ? "ä¾æœˆä»½æ’åº" : "ä¾è¼¸å…¥é †åº"}ï¼‰ã€‚`);
  }

  // å¹³å‡æœˆæŠ•ä¿è–ªè³‡ï¼šæœ€é«˜60å€‹æœˆå¹³å‡ï¼ˆæˆ–æœªæ»¿60ç”¨å…¨éƒ¨å¹³å‡ï¼‰
  const avgRes = calcAvgTop60(salParsed.salaries);
  if(!Number.isFinite(avgRes.avg) || avgRes.avg<=0){
    alert("æŠ•ä¿è–ªè³‡è³‡æ–™è§£æå¤±æ•—ï¼Œè«‹ç¢ºèªæ¯è¡Œç‚ºæœ‰æ•ˆé‡‘é¡");
    return;
  }

  // æ³•å®šè«‹é ˜å¹´é½¡èˆ‡åŠ æ¸›çµ¦
  const legal = RULES.legalAgeByBirthRoc(roc);
  const legalMonths = ageToMonths(legal.years, legal.months);
  const claimMonthsTotal = ageToMonths(claimY, claimM);
  const adj = adjustFactor(legalMonths, claimMonthsTotal);

  const earlyTooMuch = (adj.diffMonths < -60);
  const lateTooMuch  = (adj.diffMonths >  60);

  // å¹´é‡‘ï¼ˆéœ€å¹´è³‡æ»¿15å¹´ï¼‰
  const eligiblePension = insMonthsTotal >= 15*12;

  let pension = null;
  if(eligiblePension){
    pension = calcPension(avgRes.avg, insMonthsTotal, adj.factor);
  }

  // ä¸€æ¬¡é‡‘ï¼ˆä»»ä½•å¹´è³‡éƒ½å¯è©¦ç®—ï¼‰
  const lump = calcLumpSum(avgRes.avg, insMonthsTotal);

  // é¡¯ç¤º
  const out = $("output");
  out.style.display="block";

  const diffText = (adj.diffMonths === 0)
    ? "ä¾æ³•å®šå¹´é½¡è«‹é ˜ï¼ˆä¸åŠ æ¸›çµ¦ï¼‰"
    : (adj.diffMonths > 0)
      ? `å±•å»¶ ${Math.abs(adj.diffMonths)} å€‹æœˆï¼ˆç´„ ${adj.rawYears.toFixed(2)} å¹´ï¼›ä¸Šé™æ¡ ${adj.cappedYears.toFixed(2)} å¹´ï¼‰`
      : `ææ—© ${Math.abs(adj.diffMonths)} å€‹æœˆï¼ˆç´„ ${Math.abs(adj.rawYears).toFixed(2)} å¹´ï¼›ä¸Šé™æ¡ ${Math.abs(adj.cappedYears).toFixed(2)} å¹´ï¼‰`;

  const capWarn = (earlyTooMuch || lateTooMuch)
    ? `<div class="warn" style="display:block;margin-top:10px">
         ä½ è¼¸å…¥çš„è«‹é ˜å¹´é½¡èˆ‡æ³•å®šå¹´é½¡ç›¸å·®è¶…é 5 å¹´ã€‚ä¾è¦å®šææ—©/å±•å»¶æœ€å¤š 5 å¹´ï¼ˆÂ±20%ï¼‰ï¼Œæœ¬å·¥å…·å·²è‡ªå‹•ã€Œå°é ‚ã€è¨ˆç®—ã€‚
       </div>`
    : "";

  const pensionBlock = eligiblePension ? `
    <div style="font-weight:900;font-size:16px;margin-top:10px">è€å¹´å¹´é‡‘ï¼ˆä¼°ç®—ï¼‰</div>
    <div style="font-weight:900;font-size:18px;margin-top:6px">
      é ä¼°æ¯æœˆå¯é ˜ï¼šNT$ ${fmt(pension.finalMonthly)}
      <span class="muted" style="font-weight:600;font-size:12.5px">ï¼ˆæ¡ç”¨ï¼š${pension.chosen}ï¼‰</span>
    </div>

    <table class="table">
      <tr><td class="muted">ç¬¬1å¼ï¼ˆæœªåŠ æ¸›çµ¦ï¼‰</td><td>NT$ ${fmt(Math.round(pension.base1))}</td></tr>
      <tr><td class="muted">ç¬¬2å¼ï¼ˆæœªåŠ æ¸›çµ¦ï¼‰</td><td>NT$ ${fmt(Math.round(pension.base2))}</td></tr>
      <tr><td class="muted">æ“‡å„ªåŸºç¤é‡‘é¡ï¼ˆæœªåŠ æ¸›çµ¦ï¼‰</td><td>NT$ ${fmt(Math.round(pension.chosenBase))}</td></tr>
      <tr><td class="muted">ææ—©/å±•å»¶ä¿‚æ•¸</td><td>Ã— ${adj.factor.toFixed(4)}</td></tr>
      <tr><td style="font-weight:900">åŠ æ¸›çµ¦å¾Œæœˆé ˜</td><td style="font-weight:900">NT$ ${fmt(pension.finalMonthly)}</td></tr>
    </table>
  ` : `
    <div class="warn" style="display:block;margin-top:10px">
      ä½ å¡«çš„å‹ä¿å¹´è³‡æœªæ»¿ 15 å¹´ï¼šä¸€èˆ¬ä¸ç¬¦åˆã€Œè€å¹´å¹´é‡‘ã€è«‹é ˜æ¢ä»¶ï¼›ä¸‹é¢ä»æä¾›ã€Œè€å¹´ä¸€æ¬¡é‡‘ã€ä¼°ç®—ã€‚
    </div>
  `;

  out.innerHTML = `
    <div style="font-weight:900;font-size:16px">é—œéµåƒæ•¸ï¼ˆä½ é€™æ¬¡çš„ã€ŒçœŸå¯¦åŸºç¤ã€ï¼‰</div>
    <table class="table">
      <tr><td class="muted">å¹´è³‡ï¼ˆæ›ç®—ï¼‰</td><td>${insY}å¹´ ${insM}æœˆ ${insD}å¤© â†’ <b>${insMonthsTotal}</b> å€‹æœˆï¼ˆâ‰ˆ ${(insMonthsTotal/12).toFixed(2)} å¹´ï¼‰</td></tr>
      <tr><td class="muted">æŠ•ä¿è–ªè³‡è³‡æ–™ç­†æ•¸</td><td>${salParsed.count} å€‹æœˆ</td></tr>
      <tr><td class="muted">å¹³å‡æœˆæŠ•ä¿è–ªè³‡ï¼ˆè¨ˆç®—è¦å‰‡ï¼‰</td><td>${avgRes.rule}</td></tr>
      <tr><td class="muted">å¹³å‡æœˆæŠ•ä¿è–ªè³‡ï¼ˆçµæœï¼‰</td><td><b>NT$ ${fmt(Math.round(avgRes.avg))}</b></td></tr>
      <tr><td class="muted">æ³•å®šè«‹é ˜å¹´é½¡ï¼ˆä¾å‡ºç”Ÿå¹´æ¬¡ï¼‰</td><td>${legal.years}æ­²</td></tr>
      <tr><td class="muted">ä½ è¨­å®šçš„è«‹é ˜å¹´é½¡</td><td>${claimY}æ­² ${claimM}æœˆ</td></tr>
      <tr><td class="muted">ææ—©/å±•å»¶åˆ¤å®š</td><td>${diffText}</td></tr>
    </table>

    ${capWarn}
    ${pensionBlock}

    <div style="font-weight:900;font-size:16px;margin-top:14px">è€å¹´ä¸€æ¬¡é‡‘ï¼ˆä¼°ç®—ï¼‰</div>
    <div class="small muted">çµ¦ä»˜é‡‘é¡ï¼å¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— çµ¦ä»˜æœˆæ•¸ï¼ˆå¹´è³‡æ¯æ»¿1å¹´ç´„=1å€‹æœˆï¼›ä¸è¶³æŒ‰æ¯”ä¾‹ï¼›æœªæ»¿30æ—¥ä»¥1å€‹æœˆè¨ˆï¼‰ã€‚</div>
    <table class="table">
      <tr><td class="muted">çµ¦ä»˜æœˆæ•¸ï¼ˆä¼°ï¼‰</td><td>${lump.benefitMonths.toFixed(4)} å€‹æœˆ</td></tr>
      <tr><td style="font-weight:900">ä¸€æ¬¡é‡‘é‡‘é¡ï¼ˆä¼°ï¼‰</td><td style="font-weight:900">NT$ ${fmt(lump.amount)}</td></tr>
    </table>

    <div class="small muted" style="margin-top:10px">
      æé†’ï¼šä¸€æ¬¡é‡‘åœ¨å¯¦å‹™é‚„å¯èƒ½å—ã€Œé€¾60æ­²ç¹¼çºŒå·¥ä½œè€…ï¼Œå…¶é€¾60æ­²å¾Œå¹´è³‡æœ€å¤šè¨ˆ5å¹´ã€ç­‰æ¢ä»¶å½±éŸ¿ï¼›æœ¬å·¥å…·æœªæ‹†åˆ†60æ­²å‰å¾Œå¹´è³‡ï¼Œè‹¥ä½ è¦æ›´ç²¾æº–ï¼Œå¯æŠŠ60æ­²å¾Œå¹´è³‡å¦å¡«ä¸¦åŠ ä¸Šå°é ‚è¦å‰‡ï¼ˆæˆ‘ä¹Ÿå¯ä»¥å†å¹«ä½ åŠ ï¼‰ã€‚
    </div>
  `;
}

function loadExample(){
  // ç¯„ä¾‹ï¼šä»¥åºåˆ—æ–¹å¼è²¼ 72 å€‹æœˆï¼Œè®“å·¥å…·æœƒå–æœ€é«˜60å€‹æœˆå¹³å‡
  const arr = [];
  for(let i=0;i<12;i++) arr.push("38200");
  for(let i=0;i<24;i++) arr.push("45800");
  for(let i=0;i<36;i++) arr.push("48000");
  $("salaryLines").value = arr.join("\n");
  showOk("å·²å¸¶å…¥ç¯„ä¾‹ï¼š72å€‹æœˆæŠ•ä¿è–ªè³‡åºåˆ—ï¼ˆå·¥å…·æœƒè‡ªå‹•å–æœ€é«˜60å€‹æœˆå¹³å‡ï¼‰");
  showWarn("");
  hideOutput();
}

(function init(){
  // é è¨­ï¼šä»Šå¤©ä¸éœ€è¦æ—¥æœŸï¼Œç›´æ¥é å‡ºç”Ÿå¹´æ¬¡æ¨æ³•å®šå¹´é½¡
  ["birthRoc","claimYears","claimMonths","insYears","insMonths","insDays","salaryLines"].forEach(id=>{
    $(id).addEventListener("input", hideOutput);
    $(id).addEventListener("change", hideOutput);
  });
})();
</script>
</body>
</html>
