<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>勞保退休金試算工具（制度精準版）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial,"Noto Sans TC";background:#f5f7fa;margin:0;padding:20px;color:#222}
.card{background:#fff;padding:20px;border-radius:12px;max-width:800px;margin:auto;box-shadow:0 4px 12px rgba(0,0,0,.08)}
h1{color:#0b3d91}
label{display:block;margin-top:12px;font-weight:bold}
input,select{width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #ccc}
button{margin-top:18px;padding:10px;border:0;background:#0b3d91;color:#fff;border-radius:8px;font-weight:bold;width:100%;cursor:pointer}
.result{margin-top:20px;background:#eef4ff;padding:15px;border-radius:10px}
</style>
</head>

<body>
<div class="card">
<h1>勞保退休金試算（純制度版）</h1>

<label>出生日期</label>
<input type="date" id="birth">

<label>請領年齡（歲）</label>
<input type="number" id="claimAge" value="65">

<label>目前勞保年資（年）</label>
<input type="number" id="insYears" value="30">

<label>目前勞保年資（月）</label>
<input type="number" id="insMonths" value="0">

<label>平均月投保薪資（年金/一次金用）</label>
<input type="number" id="avg60" placeholder="最高60月平均">

<label>一次請領用平均薪資（最近36月平均）</label>
<input type="number" id="avg36" placeholder="最後36月平均">

<label>98/01/01 前是否已有勞保年資？</label>
<select id="pre98">
<option value="no">否（98後才投保）</option>
<option value="yes">是（98前已有年資）</option>
</select>

<button onclick="calculate()">開始試算</button>

<div class="result" id="output"></div>
</div>

<script>
const DATE98 = new Date("2009-01-01");

function rocYear(d){
    return d.getFullYear() - 1911;
}

function legalAge(roc){
    if(roc<=46) return 60;
    if(roc==47) return 61;
    if(roc==48) return 62;
    if(roc==49) return 63;
    if(roc==50) return 64;
    return 65;
}

function calculate(){
    const birth = new Date(document.getElementById("birth").value);
    const claimAge = Number(document.getElementById("claimAge").value);
    const insYears = Number(document.getElementById("insYears").value);
    const insMonths = Number(document.getElementById("insMonths").value);
    const avg60 = Number(document.getElementById("avg60").value);
    const avg36 = Number(document.getElementById("avg36").value);
    const pre98 = document.getElementById("pre98").value==="yes";

    if(!birth || !avg60){ alert("請完整填寫資料"); return; }

    const totalMonths = insYears*12 + insMonths;
    const totalYears = totalMonths/12;

    const roc = rocYear(birth);
    const legal = legalAge(roc);

    const diffYears = claimAge - legal;
    const cappedYears = Math.max(-5,Math.min(5,diffYears));
    const factor = 1 + cappedYears*0.04;

    let resultHTML = "";

    // ========== 年金 ==========
    if(totalYears>=15){
        const base1 = avg60 * totalYears * 0.00775 + 3000;
        const base2 = avg60 * totalYears * 0.0155;
        const chosen = Math.max(base1,base2);
        const finalMonthly = Math.round(chosen * factor);

        resultHTML += `<b>老年年金（月領）</b><br>`;
        resultHTML += `試算月領：約 NT$ ${finalMonthly.toLocaleString()}<br><br>`;
    }

    // ========== 老年一次金 ==========
    if(totalYears<15 && claimAge>=legal){
        const amount = Math.round(avg60 * totalYears);
        resultHTML += `<b>老年一次金</b><br>`;
        resultHTML += `一次領：約 NT$ ${amount.toLocaleString()}<br><br>`;
    }

    // ========== 一次請領老年給付 ==========
    if(pre98 && avg36){
        let benefitMonths = 0;
        if(totalYears<=15){
            benefitMonths = totalYears;
        }else{
            benefitMonths = 15 + (totalYears-15)*2;
        }
        benefitMonths = Math.min(benefitMonths,45);
        const amount = Math.round(avg36 * benefitMonths);

        resultHTML += `<b>一次請領老年給付（舊制）</b><br>`;
        resultHTML += `一次領：約 NT$ ${amount.toLocaleString()}<br><br>`;
    }

    resultHTML += `<hr>法定請領年齡：${legal}歲<br>`;
    resultHTML += `請領調整係數：${factor.toFixed(2)}（±4%/年，上限20%）`;

    document.getElementById("output").innerHTML = resultHTML;
}
</script>
</body>
</html>
