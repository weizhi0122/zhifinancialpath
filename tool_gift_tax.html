<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>è´ˆèˆ‡ç¨…ç­–ç•¥å·¥å…·ï½œæ™º Financial Path</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="è´ˆèˆ‡ç¨…ç­–ç•¥å·¥å…·ï¼šå–®æ¬¡è©¦ç®—ï¼‹åˆ†å¹´è¦åŠƒï¼Œå«å…ç¨…é¡èˆ‡ç´šè·ï¼ˆæ•™è‚²ç”¨é€”ï¼‰ã€‚" />
<style>
  .topbar{
  background:#ffffff;
  border-bottom:1px solid #e6e8ee;
  padding:10px 20px;
  position:sticky;
  top:0;
  z-index:100;
}

.topbar-inner{
  max-width:1050px;
  margin:auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.left-nav a{
  margin-right:18px;
  text-decoration:none;
  color:#0b3d91;
  font-size:14px;
  font-weight:600;
}

.left-nav a:hover{
  text-decoration:underline;
}

.brand{
  font-size:13px;
  color:#667085;
}

  :root{
    --bg:#f6f8fb; --card:#fff; --text:#222; --muted:#667085;
    --line:#e6e8ee; --primary:#0b3d91; --soft:#eef4ff;
    --goodbg:#ecfdf3; --good:#027a48;
    --warnbg:#fff4e5; --warn:#8a5300;
  }
  body{font-family:Arial,"Noto Sans TC",sans-serif;margin:0;background:var(--bg);color:var(--text)}
  .container{max-width:1050px;margin:auto;padding:26px 18px}
  h1{margin:0 0 12px;color:var(--primary);font-size:26px}
  .grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media (min-width:980px){ .grid{grid-template-columns:1.15fr 0.85fr} }
  .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .card h2{margin:0 0 10px;font-size:16px;color:#0f172a}
  label{display:block;margin-top:10px;font-size:14px;color:#0f172a}
  input,select,button{
    width:100%;padding:10px 10px;margin-top:6px;border:1px solid #d7dbe6;border-radius:10px;
    box-sizing:border-box;background:#fff;font-size:14px;
  }
  .row{display:flex;gap:10px}
  .row > *{flex:1}
  button{margin-top:14px;background:var(--primary);color:#fff;border:0;cursor:pointer;font-weight:700}
  button.secondary{background:#334155}
  .result{margin-top:14px;padding:14px;border-radius:12px;background:var(--soft);color:var(--primary);display:none}
  .note{margin-top:10px;padding:10px 12px;border-radius:12px;background:var(--goodbg);color:var(--good);border:1px solid #b7f0cc;font-size:13px;line-height:1.4}
  .warn{display:none;margin-top:10px;padding:10px 12px;border-radius:12px;background:var(--warnbg);color:var(--warn);border:1px solid #ffe2b5;font-size:13px;line-height:1.4}
  .small{font-size:12.5px;color:var(--muted);line-height:1.45;margin-top:10px}
  .pill{display:inline-block;font-size:12px;padding:4px 8px;border-radius:999px;background:#f1f5ff;color:var(--primary);border:1px solid #dbe7ff}
  .table{width:100%;border-collapse:collapse;margin-top:10px}
  .table th,.table td{padding:7px 0;border-bottom:1px dashed #dbe2f0;font-size:13.5px}
  .table th{text-align:left;color:#0f172a}
  .table td:last-child,.table th:last-child{text-align:right}
  .muted{color:var(--muted)}
</style>
</head>

<body>
<div class="topbar">
  <div class="topbar-inner">
    <div class="left-nav">
      <a href="./tools.html">â† å›å·¥å…·</a>
      <a href="./index.html">ğŸ  å›ä¸»é </a>
    </div>
    <div class="right-nav">
      <span class="brand">æ™º Financial Path</span>
    </div>
  </div>
</div>

<div class="container">
  <h1>è´ˆèˆ‡ç¨…ç­–ç•¥å·¥å…· <span class="pill">115å¹´å…ç¨…é¡ 244 è¬</span></h1>

  <div class="grid">
    <!-- å·¦ï¼šè¼¸å…¥ -->
    <div class="card">
      <h2>1) è´ˆèˆ‡è³‡è¨Šï¼ˆå–®æ¬¡ï¼æœ¬å¹´åº¦ï¼‰</h2>

      <label>è´ˆèˆ‡æ—¥ï¼ˆæ±ºå®šé©ç”¨ç´šè·ï¼‰</label>
      <input id="giftDate" type="date" />

      <div class="row">
        <div>
          <label>æœ¬æ¬¡è´ˆèˆ‡é‡‘é¡ï¼ˆNT$ï¼‰</label>
          <input id="giftNow" type="text" inputmode="numeric" placeholder="ä¾‹ï¼š5,000,000" />
        </div>
        <div>
          <label>åŒå¹´åº¦ã€Œå·²è´ˆèˆ‡ç´¯è¨ˆã€ï¼ˆNT$ï¼‰</label>
          <input id="giftYTD" type="text" inputmode="numeric" placeholder="æ²’æœ‰å°±å¡« 0" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>è´ˆèˆ‡äººæ•¸ï¼ˆç­–ç•¥å¸¸ç”¨ï¼šå¤«å¦»å„è‡ªè´ˆèˆ‡ï¼‰</label>
          <select id="donors">
            <option value="1">1 ä½è´ˆèˆ‡äºº</option>
            <option value="2">2 ä½è´ˆèˆ‡äººï¼ˆå¸¸è¦‹ï¼šå¤«å¦»ï¼‰</option>
          </select>
        </div>
        <div>
          <label>æ¯ä½è´ˆèˆ‡äººå…ç¨…é¡ï¼ˆNT$ / å¹´ï¼‰</label>
          <input id="exemptEach" type="text" inputmode="numeric" />
        </div>
      </div>

      <label>å…¶ä»–å¯æ‰£é™¤é‡‘é¡ï¼ˆNT$ï¼‰</label>
      <input id="deductions" type="text" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼šé™„æœ‰è² æ“”çš„é‡‘é¡ï¼ˆç°¡åŒ–å…ˆåˆä½µå¡«ï¼‰" />

      <hr style="border:0;border-top:1px solid var(--line);margin:14px 0" />

      <h2>2) ç­–ç•¥è¦åŠƒï¼ˆåˆ†å¹´ç§»è½‰ï¼‰</h2>

      <div class="row">
        <div>
          <label>ç›®æ¨™ç§»è½‰ç¸½é¡ï¼ˆNT$ï¼‰</label>
          <input id="targetTotal" type="text" inputmode="numeric" placeholder="ä¾‹ï¼š30,000,000" />
        </div>
        <div>
          <label>åˆ†å¹¾å¹´å®Œæˆï¼ˆN å¹´ï¼‰</label>
          <input id="years" type="number" min="1" step="1" value="3" />
        </div>
      </div>

      <div class="row">
        <button onclick="run()">è¨ˆç®—ï¼šå–®æ¬¡ç¨…é¡ + ç­–ç•¥æ–¹æ¡ˆ</button>
        <button class="secondary" onclick="resetDefaults()">é‡è¨­</button>
      </div>

      <div class="warn" id="warnBox"></div>

      <div class="note">
        ç­–ç•¥è§€å¿µï¼šè´ˆèˆ‡ç¨…æŒ‰ã€Œæ›†å¹´ã€è¨ˆç®—ï¼Œæ¯ä½è´ˆèˆ‡äººæ¯å¹´éƒ½æœ‰å…ç¨…é¡ã€‚
        è‹¥èƒ½ã€Œåˆ†å¹´ã€ï¼‹ã€Œåˆ†è´ˆèˆ‡äººã€ç§»è½‰ï¼Œé€šå¸¸å¯é™ä½æˆ–å»¶å¾Œç¨…è² ï¼ˆä»é ˆç¬¦åˆæ³•è¦èˆ‡å¯¦è³ªè¦ä»¶ï¼‰ã€‚
      </div>

      <p class="small">
        â€» æ•™è‚²ç”¨é€”ï¼šæ‰£é™¤é¡èˆ‡ä¸è¨ˆå…¥è´ˆèˆ‡ç¸½é¡é …ç›®å¾ˆå¤šï¼Œæ­¤å·¥å…·å…ˆç”¨ã€Œå…¶ä»–å¯æ‰£é™¤é‡‘é¡ã€åˆä½µç°¡åŒ–ã€‚<br/>
        â€» ç´šè·èˆ‡å…ç¨…é¡ï¼šå…ç¨…é¡ 244 è¬ï¼›114/1/1 èµ·è´ˆèˆ‡ç¨…ç´šè·ä¸Šé™èª¿é«˜ï¼ˆ28,110,000 / 56,210,000ï¼‰ã€‚
      </p>
    </div>

    <!-- å³ï¼šçµæœ -->
    <div class="card">
      <h2>çµæœ</h2>
      <div id="output" class="result"></div>
      <div class="small muted" style="margin-top:10px">
        æƒ³æŠŠã€Œç­–ç•¥ã€åšæ›´åƒæŠ•è³‡æ±ºç­–ï¼Ÿä¸‹ä¸€æ­¥å¯ä»¥åŠ ï¼š<br/>
        1) æŠŠæ¯å¹´è´ˆèˆ‡å¾Œçš„è³‡ç”¢æ”¹ç”±å—è´ˆäººæŠ•è³‡ï¼Œä¼°ç®—ã€Œç¨…è²  vs è³‡ç”¢æˆé•·ã€å·®ç•°ï¼›<br/>
        2) æŠŠå—è´ˆäººæ”¹æˆå¤šä½ï¼Œç”¢å‡ºã€Œåˆ†é…å»ºè­°è¡¨ã€ã€‚<br/>
      </div>
    </div>
  </div>
</div>

<script>
/** ========= è¦å‰‡ï¼ˆä¾å®˜æ–¹è³‡è¨Šï¼‰ =========
 * å…ç¨…é¡ï¼šæ¯ä½è´ˆèˆ‡äººæ¯å¹´ 2,440,000ï¼ˆ115å¹´ï¼‰
 * è´ˆèˆ‡ç¨…ç´šè·ï¼š114/1/1 èµ· 28,110,000 / 56,210,000ï¼Œä¸¦æœ‰ç´¯é€²å·®é¡ 
 */
const RULES = {
  exemptEach: 2440000,
  newBracketFrom: "2025-01-01", // 114/01/01
  brackets_old: [
    { upTo: 25000000, rate: 0.10, quick: 0 },
    { upTo: 50000000, rate: 0.15, quick: 1250000 },
    { upTo: Infinity, rate: 0.20, quick: 3750000 }
  ],
  brackets_new: [
    { upTo: 28110000, rate: 0.10, quick: 0 },
    { upTo: 56210000, rate: 0.15, quick: 1405500 },
    { upTo: Infinity, rate: 0.20, quick: 4216000 }
  ]
};

function $(id){ return document.getElementById(id); }

function parseMoney(id){
  const raw = ($(id).value || "").toString().trim();
  if(!raw) return 0;
  const cleaned = raw.replace(/[,ï¼Œ\s]/g, "");
  const n = Number(cleaned);
  return Number.isFinite(n) ? n : NaN;
}

function formatNum(n){
  try { return Number(n).toLocaleString("en-US"); } catch { return String(n); }
}

function setWarn(msg){
  const w = $("warnBox");
  if(!msg){ w.style.display="none"; w.textContent=""; return; }
  w.style.display="block";
  w.textContent = msg;
}

function getBrackets(){
  const d = ($("giftDate").value || "").trim();
  if(!d) return { name:"æ–°åˆ¶(é è¨­)", arr: RULES.brackets_new };
  if(d >= RULES.newBracketFrom) return { name:"æ–°åˆ¶(114/1/1èµ·)", arr: RULES.brackets_new };
  return { name:"èˆŠåˆ¶(114/1/1å‰)", arr: RULES.brackets_old };
}

/** è¨ˆç®—ã€Œç´¯è¨ˆåˆ°ç›®å‰ã€çš„ç¸½ç¨…é¡ï¼Œå†æ‰£æ‰ã€Œå·²è´ˆèˆ‡éƒ¨åˆ†ã€çš„ç¸½ç¨…é¡ => æœ¬æ¬¡æ‡‰ç´ */
function calcGiftTaxIncremental(giftYTD, giftNow, donors, exemptEach, deductions, brackets){
  const totalGift = giftYTD + giftNow;

  const totalTax = calcGiftTaxTotal(totalGift, donors, exemptEach, deductions, brackets);
  const ytdTax = calcGiftTaxTotal(giftYTD, donors, exemptEach, deductions, brackets);

  const payNow = Math.max(0, totalTax.tax - ytdTax.tax);

  return {
    bracketsName: totalTax.bracketsName,
    taxableTotal: totalTax.taxable,
    taxTotal: totalTax.tax,
    taxableYTD: ytdTax.taxable,
    taxYTD: ytdTax.tax,
    payNow
  };
}

/** ä¾ã€Œå¹´åº¦ç´¯è¨ˆè´ˆèˆ‡ç¸½é¡ã€è¨ˆç®—ï¼šèª²ç¨…æ·¨é¡ã€ç¸½ç¨…é¡ï¼ˆå·²å«ç´¯é€²å·®é¡ï¼‰ */
function calcGiftTaxTotal(giftTotal, donors, exemptEach, deductions, brackets){
  const exemptTotal = donors * exemptEach;

  let taxable = giftTotal - exemptTotal - deductions;
  if(taxable < 0) taxable = 0;

  // æ‰¾ç´šè·ï¼ˆç”¨ quick/ç´¯é€²å·®é¡ï¼‰
  let rate=0, quick=0, upTo=0;
  for(const b of brackets){
    if(taxable <= b.upTo){ rate=b.rate; quick=b.quick; upTo=b.upTo; break; }
  }
  const tax = Math.max(0, taxable * rate - quick);

  return {
    bracketsName: getBrackets().name,
    giftTotal, donors, exemptTotal, deductions,
    taxable, rate, quick, upTo,
    tax
  };
}

/** ç­–ç•¥ï¼šæŠŠ targetTotal åœ¨ N å¹´å…§å¹³å‡åˆ†é…ï¼ˆæ¯å¹´åŒé¡ï¼‰ï¼Œä¸¦æ¯”è¼ƒï¼š
 * A) 1 ä½è´ˆèˆ‡äºº
 * B) 2 ä½è´ˆèˆ‡äººï¼ˆè‹¥ä½¿ç”¨è€…é¸ 2ï¼‰
 * æ¯å¹´ä½¿ç”¨ç•¶å¹´åº¦å…ç¨…é¡ï¼Œé€šå¸¸æœƒçœ‹åˆ°ç¨…è² ä¸‹é™/å»¶å¾Œ
 */
function planStrategy(targetTotal, years, donors, exemptEach, brackets){
  const perYear = targetTotal / years;

  const rows = [];
  let remaining = targetTotal;
  let cumTax = 0;

  for(let i=1;i<=years;i++){
    const give = (i===years) ? remaining : perYear;
    remaining -= give;

    // æ¯å¹´éƒ½ç•¶ä½œã€Œå¹´åº¦ç´¯è¨ˆ = giveã€ï¼ˆç­–ç•¥è¦åŠƒå¸¸è¦‹ï¼šæ¯å¹´åˆ†é–‹åšï¼‰
    const r = calcGiftTaxTotal(give, donors, exemptEach, 0, brackets);
    cumTax += r.tax;

    rows.push({
      yearIndex: i,
      give,
      exempt: r.exemptTotal,
      taxable: r.taxable,
      tax: r.tax
    });
  }
  return { perYear, rows, cumTax };
}

function run(){
  setWarn("");

  const giftNow = parseMoney("giftNow");
  const giftYTD = parseMoney("giftYTD");
  const deductions = parseMoney("deductions");
  const exemptEach = parseMoney("exemptEach");
  const donors = Number($("donors").value);

  if(!Number.isFinite(giftNow) || giftNow < 0){ alert("æœ¬æ¬¡è´ˆèˆ‡é‡‘é¡è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—"); return; }
  if(!Number.isFinite(giftYTD) || giftYTD < 0){ alert("å·²è´ˆèˆ‡ç´¯è¨ˆè«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—"); return; }
  if(!Number.isFinite(deductions) || deductions < 0){ alert("æ‰£é™¤é‡‘é¡è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—"); return; }
  if(!Number.isFinite(exemptEach) || exemptEach < 0){ alert("å…ç¨…é¡è«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—"); return; }

  const {name, arr} = getBrackets();

  // å–®æ¬¡/æœ¬æ¬¡æ‡‰ç´ï¼ˆç”¨ç´¯è¨ˆå·®é¡è§€å¿µï¼‰
  const inc = calcGiftTaxIncremental(giftYTD, giftNow, donors, exemptEach, deductions, arr);

  // ç­–ç•¥è¦åŠƒ
  const targetTotal = parseMoney("targetTotal");
  const years = Math.max(1, Math.floor(Number($("years").value || 1)));

  let strategyHtml = `<div class="muted">ï¼ˆå°šæœªè¼¸å…¥ç›®æ¨™ç§»è½‰ç¸½é¡ï¼Œç•¥éç­–ç•¥è¡¨ï¼‰</div>`;
  if(Number.isFinite(targetTotal) && targetTotal > 0){
    // åŒè´ˆèˆ‡äººæ•¸çš„ç­–ç•¥
    const planSame = planStrategy(targetTotal, years, donors, exemptEach, arr);

    // åŒé‡‘é¡ã€Œä¸€æ¬¡å…¨é€ã€çš„æ¦‚å¿µå°ç…§ï¼ˆåŒä¸€å¹´å…§ï¼‰
    const lump = calcGiftTaxTotal(targetTotal, donors, exemptEach, 0, arr);

    // å¦‚æœ donors=2ï¼Œå†å¤šç®— donors=1 ç•¶æ¯”è¼ƒï¼ˆè®“ç­–ç•¥æ„Ÿæ›´å¼·ï¼‰
    let compareHtml = "";
    if(donors === 2){
      const plan1 = planStrategy(targetTotal, years, 1, exemptEach, arr);
      const lump1 = calcGiftTaxTotal(targetTotal, 1, exemptEach, 0, arr);
      compareHtml = `
        <div style="margin-top:10px;font-weight:800">ç­–ç•¥æ¯”è¼ƒï¼š1 ä½ vs 2 ä½è´ˆèˆ‡äºº</div>
        <table class="table">
          <tr><th class="muted">æ–¹æ¡ˆ</th><th class="muted">ä¸€æ¬¡å…¨é€ï¼ˆä¼°ï¼‰</th><th class="muted">åˆ†å¹´ï¼ˆ${years}å¹´ï¼‰ç¸½ç¨…é¡ï¼ˆä¼°ï¼‰</th></tr>
          <tr><td>1 ä½è´ˆèˆ‡äºº</td><td>NT$ ${formatNum(Math.round(lump1.tax))}</td><td>NT$ ${formatNum(Math.round(plan1.cumTax))}</td></tr>
          <tr><td>2 ä½è´ˆèˆ‡äºº</td><td>NT$ ${formatNum(Math.round(lump.tax))}</td><td>NT$ ${formatNum(Math.round(planSame.cumTax))}</td></tr>
        </table>
        <div class="small muted">æç¤ºï¼šè‹¥è¦åšåˆ°ã€Œ2 ä½å…ç¨…é¡éƒ½ç”¨åˆ°ã€ï¼Œå¸¸è¦‹ä½œæ³•æ˜¯å¤«å¦»å„è‡ªä»¥è‡ªå·±åç¾©è´ˆèˆ‡ï¼ˆå¯¦å‹™ä»é ˆç¬¦åˆå¯¦è³ªè³‡é‡‘ä¾†æºèˆ‡æµç¨‹ï¼‰ã€‚</div>
      `;
    }

    strategyHtml = `
      <div style="margin-top:10px;font-weight:800">ç­–ç•¥æ–¹æ¡ˆï¼š${years} å¹´åˆ†å¹´ç§»è½‰ï¼ˆæ¯å¹´ç´„ NT$ ${formatNum(Math.round(planSame.perYear))}ï¼‰</div>
      <table class="table">
        <tr>
          <th class="muted">ç¬¬Nå¹´</th>
          <th class="muted">ç•¶å¹´è´ˆèˆ‡</th>
          <th class="muted">å…ç¨…é¡ï¼ˆåˆè¨ˆï¼‰</th>
          <th class="muted">èª²ç¨…æ·¨é¡</th>
          <th class="muted">ç•¶å¹´ç¨…é¡</th>
        </tr>
        ${planSame.rows.map(r=>`
          <tr>
            <td>ç¬¬ ${r.yearIndex} å¹´</td>
            <td>NT$ ${formatNum(Math.round(r.give))}</td>
            <td>NT$ ${formatNum(Math.round(r.exempt))}</td>
            <td>NT$ ${formatNum(Math.round(r.taxable))}</td>
            <td>NT$ ${formatNum(Math.round(r.tax))}</td>
          </tr>
        `).join("")}
        <tr>
          <td style="font-weight:800">åˆè¨ˆ</td>
          <td></td><td></td><td></td>
          <td style="font-weight:800">NT$ ${formatNum(Math.round(planSame.cumTax))}</td>
        </tr>
      </table>

      <div style="margin-top:10px;font-weight:800">å°ç…§ï¼šåŒä¸€å¹´ã€Œä¸€æ¬¡ç§»è½‰ã€ä¼°ç®—</div>
      <table class="table">
        <tr><td class="muted">ç›®æ¨™ç§»è½‰ç¸½é¡</td><td>NT$ ${formatNum(Math.round(targetTotal))}</td></tr>
        <tr><td class="muted">å…ç¨…é¡ï¼ˆåˆè¨ˆï¼‰</td><td>- NT$ ${formatNum(Math.round(lump.exemptTotal))}</td></tr>
        <tr><td class="muted">èª²ç¨…è´ˆèˆ‡æ·¨é¡</td><td>NT$ ${formatNum(Math.round(lump.taxable))}</td></tr>
        <tr><td style="font-weight:800">ä¸€æ¬¡ç§»è½‰ç¨…é¡ï¼ˆä¼°ï¼‰</td><td style="font-weight:800">NT$ ${formatNum(Math.round(lump.tax))}</td></tr>
      </table>

      ${compareHtml}
    `;
  }

  // è¼¸å‡º
  const out = $("output");
  out.style.display = "block";

  out.innerHTML = `
    <div style="font-weight:800;font-size:16px;margin-bottom:6px">
      æœ¬æ¬¡æ‡‰ç´è´ˆèˆ‡ç¨…ï¼ˆä¼°ï¼‰ï¼šNT$ ${formatNum(Math.round(inc.payNow))}
      <span class="muted" style="font-weight:600;font-size:12.5px">ï¼ˆç´šè·ï¼š${name}ï¼‰</span>
    </div>

    <table class="table">
      <tr><td class="muted">æœ¬å¹´åº¦å·²è´ˆèˆ‡ç´¯è¨ˆ</td><td>NT$ ${formatNum(Math.round(giftYTD))}</td></tr>
      <tr><td class="muted">æœ¬æ¬¡è´ˆèˆ‡</td><td>NT$ ${formatNum(Math.round(giftNow))}</td></tr>
      <tr><td class="muted">æœ¬å¹´åº¦è´ˆèˆ‡åˆè¨ˆ</td><td>NT$ ${formatNum(Math.round(giftYTD + giftNow))}</td></tr>
      <tr><td class="muted">è´ˆèˆ‡äººæ•¸</td><td>${donors} ä½</td></tr>
      <tr><td class="muted">å…ç¨…é¡ï¼ˆåˆè¨ˆï¼‰</td><td>- NT$ ${formatNum(Math.round(donors * exemptEach))}</td></tr>
      <tr><td class="muted">å…¶ä»–æ‰£é™¤é‡‘é¡</td><td>- NT$ ${formatNum(Math.round(deductions))}</td></tr>
      <tr><td class="muted">èª²ç¨…è´ˆèˆ‡æ·¨é¡ï¼ˆå¹´åº¦ï¼‰</td><td>NT$ ${formatNum(Math.round(inc.taxableTotal))}</td></tr>
      <tr><td class="muted">å¹´åº¦ç¸½ç¨…é¡ï¼ˆä¼°ï¼‰</td><td>NT$ ${formatNum(Math.round(inc.taxTotal))}</td></tr>
      <tr><td class="muted">å·²è´ˆèˆ‡éƒ¨åˆ†ç¨…é¡ï¼ˆä¼°ï¼‰</td><td>- NT$ ${formatNum(Math.round(inc.taxYTD))}</td></tr>
      <tr><td style="font-weight:800">æœ¬æ¬¡æ‡‰ç´ï¼ˆä¼°ï¼‰</td><td style="font-weight:800">NT$ ${formatNum(Math.round(inc.payNow))}</td></tr>
    </table>

    ${strategyHtml}
  `;

  // åƒåˆ†ä½æ ¼å¼åŒ–è¼¸å…¥
  ["giftNow","giftYTD","deductions","exemptEach","targetTotal"].forEach(id=>{
    const v = parseMoney(id);
    if(Number.isFinite(v) && v >= 0) $(id).value = formatNum(v);
  });

  // å°æé†’ï¼šå¦‚æœæ²’å¡«æ—¥æœŸï¼Œç”¨æ–°åˆ¶ä½†æé†’
  if(!($("giftDate").value || "").trim()){
    setWarn("ä½ å°šæœªé¸æ“‡è´ˆèˆ‡æ—¥ï¼Œå·¥å…·å…ˆä»¥ã€Œ114/1/1 èµ·æ–°ç´šè·ã€ä¼°ç®—ï¼›è‹¥æ¡ˆä»¶ç™¼ç”Ÿæ—¥åœ¨ 113/12/31 ä»¥å‰ï¼Œç´šè·æœƒä¸åŒã€‚");
  }
}

function resetDefaults(){
  // date = today
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth()+1).padStart(2,"0");
  const dd = String(now.getDate()).padStart(2,"0");
  $("giftDate").value = `${yyyy}-${mm}-${dd}`;

  $("giftNow").value = "";
  $("giftYTD").value = "0";
  $("donors").value = "1";
  $("exemptEach").value = formatNum(RULES.exemptEach);
  $("deductions").value = "0";

  $("targetTotal").value = "";
  $("years").value = 3;

  setWarn("");
  $("output").style.display="none";
  $("output").innerHTML="";
}

(function init(){
  resetDefaults();
  // blur => format
  ["giftNow","giftYTD","exemptEach","deductions","targetTotal"].forEach(id=>{
    $(id).addEventListener("blur", ()=>{
      const v = parseMoney(id);
      if(Number.isFinite(v) && v>=0) $(id).value = formatNum(v);
    });
  });
})();
</script>
</body>
</html>
